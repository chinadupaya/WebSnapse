{"version":3,"sources":["components/stylesheet.js","components/Snapse/useAnimateEdges.js","utils/helpers.js","components/Snapse/Snapse.js","utils/automata.js","components/forms/ChooseRuleForm.js","components/forms/NewNodeForm.js","components/forms/EditNodeForm.js","components/forms/DeleteNodeForm.js","components/ChoiceHistory/ChoiceHistory.js","components/useUnsavedChanges/useUnsavedChanges.js","App.js","reportWebVitals.js","index.js"],"names":["styles","selector","style","color","content","events","height","shape","width","useAnimateEdges","cyRef","useRef","useEffect","raf","cy","current","animOffset","animate","edges","requestAnimationFrame","cancelAnimationFrame","internal","createOutputNeuron","id","x","y","label","output","spike","data","rootId","classes","position","parent","checkValidRule","rule","result","exec","console","log","createEdge","src","dst","c","source","target","allRulesValid","rules","splitRules","split","count","i","length","Snapse","neurons","onEdgeCreate","handleChangePosition","setCy","elements","newId","time","array","nodes","k","element","isOutput","newOutputNode","bitstring","push","newNodes","spikes","delay","replace","out","newEdge","newEdges","convertElements","on","evt","gridGuide","guidelinesStyle","strokeStyle","horizontalDistColor","verticalDistColor","initPosAlignmentColor","edgehandles","handleNodes","preview","loopAllowed","edgeType","sourceNode","targetNode","complete","Button","className","variant","onClick","center","fit","zoom","level","CytoscapeComponent","normalizeElements","stylesheet","parseRule","testRes","forgetRes","requires","grouped","symbol","consumes","produces","delayStr","parseInt","canUseRule","step","isRandom","handleStartGuidedMode","handleSimulationEnd","newStates","produce","draft","spikeAdds","outputTracker","neuronValidRules","shouldEnd","neuron","currentRule","validRules","chosenRule","randomIndex","Math","floor","random","Object","keys","newDelay","valueOf","newSpikes","neuronOutKeys","newString","localStorage","setItem","JSON","stringify","backStep","parse","getItem","ChooseRuleForm","showChooseRuleModal","handleCloseChooseRuleModal","handleChosenRules","useImmer","values","setValues","handleSelectChange","event","neuronId","currentValues","value","GroupRules","options","neuronOptions","map","Form","Group","Label","Control","as","onChange","ruleList","form","Modal","show","onHide","backdrop","keyboard","Header","Title","Body","onSubmit","e","preventDefault","type","formReducer","state","reset","startingSpikes","name","NewNodeForm","showNewNodeModal","handleCloseModal","handleNewNode","handleError","handleClose","useReducer","formData","setFormData","useState","setSubmitting","handleChange","closeButton","shortid","generate","setTimeout","newNeuron","required","placeholder","Text","EditNodeForm","showEditModal","handleCloseEditModal","handleEditNode","setNeuronId","setRules","setStartingSpikes","filteredObject","reduce","r","firstUpdate","DeleteNodeForm","showDeleteModal","handleCloseDeleteModal","handleDeleteNode","defaultNeuron","defaultValue","TableCell","TableRow","ChoiceHistory","showChoiceHistoryModal","handleCloseHoiceHistoryModal","getLatestState","neuronIds","neuronRows","neuronCells","Table","striped","bordered","hover","useUnsavedChanges","isDirty","setDirty","message","handleUnsavedChanges","window","onbeforeunload","addEventListener","removeEventListener","when","compact","ignoreComment","spaces","sanitize","keypresses","originalNeurons","n1","n2","n3","n4","useKey","key","cb","callbackRef","handleKeyDown","code","document","fn","timerId","args","clearTimeout","debounced","shortening","keyframes","ProgressBar","styled","div","props","isPlaying","css","App","setNeurons","setTime","setIsRandom","fileName","setFileName","Prompt","setPristine","setShowNewNodeModal","setShowChooseRuleModal","setShowEditModal","setShowChoiceHistoryModal","setShowDeleteModal","setIsPlaying","hasEnded","setHasEnded","error","setError","pBar","setPBar","alert","showError","text","a","outCopy","handleNewPosition","arr","filter","item","handleReset","clear","guidedRules","setGuidedRules","onForward","onBackward","tempTime","onIntervalStepRef","p","interval","setInterval","clearInterval","path","Container","Alert","Dropdown","Toggle","Menu","Item","size","disabled","File","custom","input","file","files","indexOf","reader","FileReader","removeJsonTextAttribute","parentElement","_parent","pOpKeys","keyNo","keyName","arrOfKey","arrIndex","nativeType","trim","ignoreDeclaration","ignoreInstruction","ignoreAttributes","ignoreCdata","ignoreDoctype","textFn","convert","xml2js","readAsText","nValue","Number","isNaN","bValue","toLowerCase","handleLoad","wrapper","json2xml","blob","Blob","saveAs","Date","toString","textAlign","fontWeight","Row","Col","backgroundColor","borderRadius","padding","sm","Check","defaultChecked","OverlayTrigger","placement","hide","overlay","Tooltip","display","addedEles","remove","j","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","cytoscape","use","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.d1c7a5d8.chunk.js","sourcesContent":["const styles = [\n    {\n        selector: '.snapse-node, .snapse-output',\n        style: {\n            'font-family': 'Computer Modern',\n            'background-opacity': '0',\n            'padding-top': '0',\n            'border-width': 0,\n            'text-halign': 'left',\n            'text-valign': 'top',\n            color: 'black',\n            content: 'data(label)'\n        }\n    },\n    {\n        selector: '.snapse-node__rules, .snapse-node__output',\n        style: {\n            'font-family': 'Computer Modern',\n            'background-color': 'white',\n            'border-width': 1,\n            events: 'no',\n            'text-wrap': 'wrap',\n            'text-halign': 'center',\n            'text-valign': 'center',\n            'text-wrap':'wrap',\n            content: 'data(label)',\n            height: 150,\n            shape: 'roundrectangle',\n            width: 100\n        }\n    },\n    {\n        selector: '.snapse-node__time, .snapse-node__spike',\n        style: {\n            'font-family': 'Computer Modern',\n            'background-opacity': '0',\n            'text-halign': 'center',\n            'text-valign': 'center',\n            content: 'data(label)',\n            events: 'no',\n            height: 15,\n            shape: 'roundrectangle',\n            width: 50\n        }\n    },\n    /*     {\n            selector: 'node',\n            style: {\n                'background-opacity': '0',\n                'padding-top': '0',\n                'text-halign': 'left',\n                'text-valign': 'top',\n                color: 'black',\n                content: 'data(label)',\n                'border-width': 1,\n                events: 'no',\n                'text-wrap': 'wrap',\n                shape: 'roundrectangle'\n            }\n        }, */\n    {\n        selector: 'edge',\n        style: {\n            'font-family': 'Computer Modern',\n            'curve-style': 'bezier',\n            'target-arrow-shape': 'triangle',\n            'text-background-color': 'white',\n            'text-background-shape': 'rectangle',\n            width: 1\n        }\n    },\n    {\n        selector: '.edge--triggering',\n        style: {\n          'line-color': 'magenta',\n          'line-style': 'dashed',\n          'target-arrow-color': 'magenta',\n          width: 3\n        }\n    }\n]\nexport default styles;\n","import { useEffect, useRef } from 'react'\nimport cytoscapejs from 'cytoscape'\n\nfunction useAnimateEdges() {\n  const cyRef = useRef(null)\n  const setCy = (internal) => {\n    cyRef.current = internal\n  }\n\n  useEffect(() => {\n    const cy = cyRef.current\n    let raf\n    let animOffset = 0\n\n    function animate() {\n      animOffset++\n      if (cy) {\n        cy.edges().animate({\n          style: { 'line-dash-offset': -animOffset }\n        })\n      }\n      raf = requestAnimationFrame(animate)\n    }\n\n    animate()\n\n    return () => {\n      if (raf) {\n        cancelAnimationFrame(raf)\n      }\n    }\n  }, [])\n\n  return [cyRef, setCy]\n}\n\nexport default useAnimateEdges\n","export const createNeuron = (newId, x,\n    y,\n    rules,\n    spike,\n    time) => [{\n        data: {\n            id: newId,\n            label: newId\n        },\n        position: { x: x, y: y },\n        classes: 'snapse-node'\n    },\n    {\n        data: {\n            id: newId + '-rules',\n            parent:newId,\n            label: rules.replace(/ /g, \"\\n\")\n        },\n        position: { x: x, y: y },\n        classes: 'snapse-node__rules'\n    },\n    {\n        data: {\n            id: newId + '-spike',\n            parent: newId,\n            label: `${(spike==0)? \"λ\" : spike}`\n        },\n        position: { x: x, y: y - 60 },\n        classes: 'snapse-node__spike'\n    },\n    {\n        data: {\n            id: newId + '-time',\n            parent: newId,\n            label: time\n        },\n        position: { x: x, y: y + 90 },\n        classes: 'snapse-node__time'\n    }];\nexport const createOutputNeuron = (id,x,y,label,output,spike) => [\n    {\n        data: { rootId: id, id: `${id}`, label },\n        classes: 'snapse-output',\n        position: { x: 0, y: 0 }\n      },\n      {\n        data: { rootId: id, id: `${id}-output`, parent: id, label: output },\n        classes: 'snapse-node__output',\n        position: { x, y: y }\n      },\n      {\n        data: { rootId: id, id: `${id}-spike`, parent: id, label: spike },\n        classes: 'snapse-node__spike',\n        position: { x, y: y + 40 }\n      }\n]\nexport const checkValidRule = (rule) =>{\n    const re = /(a+)(\\+*\\**)\\/(a+)->(a+);([0-9]+)/\n    const testRe = /(a+)(\\(*a*\\)*)(\\+*\\**)\\/(a+)->(a+);([0-9]+)/\n    const forgetRe=/(a+)(\\+*\\**)\\/(a+)->(0);(0)/\n    var result = testRe.exec(rule) || forgetRe.exec(rule);\n    console.log(result);    \n    return result;\n}\n\nexport const createEdge = (src,dst,c) =>{\n    return {\n        data: {\n          id: src + '-' + dst,\n          source: src,\n          target: dst\n        },\n        classes: c\n      };\n}\n\nexport const allRulesValid = (rules) => {\n    var splitRules = rules.split(\" \");\n    var count = 0;\n    for (var i=0;i<splitRules.length;i++){\n        if(checkValidRule(splitRules[i])!=null){\n            count+=1;\n        }else{\n            console.log(\"invalidRule\", splitRules[i])\n        }\n    }\n    if(count == splitRules.length){\n        return 1;\n    }else{\n        return 0;\n    }\n}\n\nexport const convertElements = elements =>{\n    var array = {\n        nodes: [],\n        edges:[],\n    }\n    for (var k in elements) {\n        var element = elements[k];\n        //console.log(element);\n        if(!element.isOutput){\n            var newNodes = createNeuron(element.id, element.position.x,element.position.y,element.rules, element.spikes, element.delay);\n            array.nodes.push(newNodes[0])\n            array.nodes.push(newNodes[1])\n            array.nodes.push(newNodes[2])\n            array.nodes.push(newNodes[3])\n            \n        }else{\n            var newOutputNode = createOutputNeuron(element.id, element.position.x,element.position.y, element.id, element.bitstring, 0);\n            array.nodes.push(newOutputNode[0])\n            array.nodes.push(newOutputNode[1])\n            array.nodes.push(newOutputNode[2])\n        } \n        if(element.out){\n            for (var i=0; i< element.out.length; i++){\n                if (element.delay<0) {\n                    console.log(element.delay)\n                    for (let out of element.out) {\n                      var newEdge = createEdge(element.id, element.out[i],' edge--triggering');\n                      array.edges.push(newEdge);\n                    }\n                }else{\n                    var newEdges = createEdge(element.id, element.out[i],'');\n                    array.edges.push(newEdges);\n                }\n            }\n        }\n    }\n    return array;\n}\n","\nimport CytoscapeComponent from 'react-cytoscapejs';\nimport stylesheet from '../stylesheet'\nimport {Button, Container} from 'react-bootstrap';\nimport useAnimateEdges from './useAnimateEdges';\nimport { useEffect, useMemo } from 'react';\nimport { convertElements } from '../../utils/helpers';\nimport {AlignCenter} from 'react-bootstrap-icons';\n\nconst Snapse = ({ neurons, onEdgeCreate, handleChangePosition }) => {\n  const [cyRef, setCy] = useAnimateEdges()\n  function handleCenterGraph(){\n    const cy = cyRef.current;\n    if(cy){\n      cy.center();\n      cy.fit();\n      cy.zoom({\n        level: 0.8,\n        position: { x: 100, y: 100 }\n      });\n    }\n  }\n  const elements = convertElements(neurons);\n  useEffect(()=>{\n    const cy = cyRef.current\n    if(cy){\n      cy.on('mouseup','.snapse-node, .snapse-output',(evt)=>{\n        console.log(\"change position\", evt.target.id())\n        handleChangePosition(evt.position, evt.target.id());\n      })\n      cy.gridGuide({\n        guidelinesStyle: {\n        strokeStyle: \"black\",\n        horizontalDistColor: \"#ff0000\",\n        verticalDistColor: \"green\",\n        initPosAlignmentColor: \"#0000ff\",\n        }\n      });\n      cy.edgehandles({\n        handleNodes: '.snapse-node, .snapse-output',\n        preview: false,\n        loopAllowed: () => false,\n        edgeType: function (sourceNode, targetNode) {\n          return 'flat'\n          //return sourceNode.edgesTo(targetNode).empty() ? 'flat' : undefined\n        },\n        complete: onEdgeCreate\n      });\n\n    }\n  },[cyRef]);\n  return (\n    <div style={{\n      width: \"100%\",\n      height: \"100%\"\n    }}>\n      <Button className=\"center-graph-button\" variant=\"secondary\" onClick={handleCenterGraph}><AlignCenter/>{' '}Center Graph</Button>\n    <CytoscapeComponent\n      cy={setCy}\n      elements={CytoscapeComponent.normalizeElements(elements)}\n      style={{\n        width: \"100%\",\n        height: \"100%\"\n      }}\n      stylesheet={stylesheet} />\n    </div>\n  )\n};\n\nexport default Snapse;","import produce from 'immer'\nexport function parseRule(rule){\n    const re = /(a+)(\\+*\\**)\\/(a+)->(a+);([0-9]+)/\n    const forgetRe=/(a+)(\\(*a*\\)*)(\\+*\\**)\\/(a+)->(0);(0)/\n    const testRe = /(a+)(\\(*a*\\)*)(\\+*\\**)\\/(a+)->(a+);([0-9]+)/\n    const res = re.exec(rule)\n    const testRes = testRe.exec(rule);\n    const forgetRes = forgetRe.exec(rule);\n    \n    /* if (res) {\n      const [, requires, symbol, consumes, produces, delayStr] = res\n      const delay = parseInt(delayStr, 10)\n      return[requires.length, symbol, consumes.length, produces.length, delay];\n    } */\n    if (testRes) {\n        //console.log(testRes);\n        const [, requires, grouped, symbol, consumes, produces, delayStr] = testRes\n        const delay = parseInt(delayStr, 10)\n        return[requires.length, grouped.length-2, symbol, consumes.length, produces.length, delay];\n    }else if(forgetRes){\n        const [, requires,grouped, symbol,consumes, produces, delayStr] = forgetRes;\n        return [requires.length,grouped.length-2, symbol, consumes.length, 0, 0];\n    }\n    \n\n    return false\n}\nexport function canUseRule(requires, grouped, symbol, spikes){\n    if(symbol == '+'){\n        if(grouped > 0){\n            if ( (spikes - requires) % grouped == 0 && (spikes-requires) >= grouped){\n                return true;\n            }\n            return false;\n        }\n        if (spikes >= requires){\n            return true\n        }\n    }\n    else if(symbol == '*'){\n        if(grouped > 0){\n            if ( (spikes - requires) % grouped == 0){\n                return true;\n            }\n            return false;\n        }\n        if (spikes >= requires-1){\n            return true\n        }\n    }\n    else if(spikes==requires){\n        return true;\n    }\n    return false;\n}\nexport function step(neurons,time,isRandom, handleStartGuidedMode, handleSimulationEnd){\n    const newStates = produce(neurons, draft =>{\n        const spikeAdds = {}\n        const outputTracker = [];\n        var neuronValidRules = {};\n        var shouldEnd = true; \n\n        for (var k in draft){\n            var neuron = draft[k];\n            //choose rule to follow if not working on a rule currently\n            if(!neuron.currentRule && !neuron.isOutput){\n                delete draft[neuron.id].currentRule;\n                //pick a rule\n                var rules = neuron.rules.split(' ');\n                var validRules=[];\n                for (var i=0;i<rules.length;i++){\n                    var [requires, grouped, symbol, consumes, produces, delay] = parseRule(rules[i]);\n                    if(canUseRule(requires,grouped,symbol,neuron.spikes)){\n                        validRules.push(rules[i]);\n                        shouldEnd = false;\n                    }\n                }   \n                if(validRules.length == 1){\n                    draft[neuron.id].currentRule = validRules[0];\n                    draft[neuron.id].chosenRule = validRules[0];\n                    var [requires, grouped, symbol, consumes, produces, delay] = parseRule(validRules[0]);\n                    draft[neuron.id].delay = delay\n                }else if(isRandom == true && validRules.length > 1){\n                    var randomIndex = Math.floor(Math.random() * (validRules.length)) \n                    var [requires, grouped, symbol, consumes, produces, delay] = parseRule(validRules[randomIndex]);\n                    draft[neuron.id].currentRule = validRules[randomIndex];\n                    draft[neuron.id].chosenRule = validRules[randomIndex];\n                    draft[neuron.id].delay = delay\n                }else if(isRandom == false && validRules.length > 1){ \n                    neuronValidRules[neuron.id] = validRules;\n                }\n                \n            }\n        }\n        if(Object.keys(neuronValidRules).length > 0){\n            //console.log(neuronValidRules);\n            handleStartGuidedMode(neuronValidRules);\n            return;\n        }\n        for (var k in draft){\n            var neuron = draft[k];\n            //work on the rule\n            if(neuron.currentRule){\n                shouldEnd = false;\n                if(neuron.delay >= 0){\n                    let newDelay = neuron.delay.valueOf();\n                    newDelay--;\n                    draft[neuron.id].delay = newDelay;\n                }\n                console.log(neuron.delay)\n                if(neuron.delay < 0){\n                    //consume spikes\n                    var [requires, grouped, symbol, consumes, produces, delay] = parseRule(neuron.currentRule);\n                    let newSpikes = neuron.spikes.valueOf();\n                    newSpikes-=consumes;\n                    draft[neuron.id].spikes = newSpikes;\n                    //send spikes\n                    const neuronOutKeys = neuron.out;\n                    for (let k of neuronOutKeys) {\n                    spikeAdds[k] =\n                        k in spikeAdds ? spikeAdds[k] + produces : produces\n                    }\n                    //resolve rule\n                    delete draft[neuron.id].currentRule;\n                } \n            } else if(neuron.isOutput){\n                outputTracker.push(neuron.id);\n                if (!(k in spikeAdds)) {\n                    spikeAdds[k] = 0\n                  }\n            }else if(neuron.delay==-1){\n                draft[neuron.id].delay=0;\n            }\n        }\n        for (const k in spikeAdds) {\n            //states[k].spikes -= spikeAdds[k]\n            let newSpikes = draft[k].spikes.valueOf();\n            newSpikes+=spikeAdds[k];\n            draft[k].spikes = newSpikes;\n            if(draft[k].isOutput){\n                var newString = `${draft[k].bitstring}${(spikeAdds[k] || '0')}`\n                draft[k].bitstring=newString;\n            }\n        }\n        //console.log(\"should end\", shouldEnd);\n        if(shouldEnd){\n            handleSimulationEnd();\n        }\n\n    })\n    localStorage.setItem(time+'sec',JSON.stringify(newStates));\n    return newStates;\n    \n}\n\nexport function backStep(time){\n    console.log(\"back step automata\");\n    var oldState = JSON.parse(localStorage.getItem(time+'sec'));\n    return oldState;\n    \n}\nexport function initialize(neurons) {\n    const states = {}\n    for (const k in neurons) {\n      const neuron = neurons[k]\n      states[k] = initializeState(neuron)\n    }\n    return states\n}\nexport function initializeState(neuron) {\n    return {\n      spikes: neuron.spikes,\n      delay: 0\n    }\n  }","import { useEffect, useState } from 'react';\nimport { Button, Form, Modal } from 'react-bootstrap';\nimport { useImmer } from 'use-immer';\n\nconst ChooseRuleForm = ({showChooseRuleModal, handleCloseChooseRuleModal,rules, handleChosenRules}) => {\n    const [values, setValues] = useImmer({});\n    useEffect(()=>{\n        setValues(currentValues =>{\n            for (var k in rules){\n                currentValues[k] = rules[k][0];\n            }\n        })\n    },[rules])\n    function onSubmit(e){\n        e.preventDefault();\n        handleChosenRules(values);\n    }\n    function handleSelectChange(event,neuronId){\n        setValues(currentValues =>{\n            for (var k in currentValues){\n                if(k == neuronId){\n                    currentValues[k] = event.target.value;\n                }\n              \n            }\n        })\n    }\n    const GroupRules = (label,options) =>{\n        let neuronOptions = options.map((neuron)=>(\n            <option value={neuron} key={neuron}>{neuron}</option>)\n        )   \n        return(\n            <Form.Group>\n                <Form.Label>{label}</Form.Label>\n                <Form.Control as=\"select\" value={values[label]} onChange={(event)=>handleSelectChange(event, label)}>\n                    {neuronOptions}\n                </Form.Control>\n            </Form.Group>\n            \n        )\n    }\n    var ruleList = Object.keys(rules);\n    var form = [];\n    for (var i=0; i<ruleList.length; i++){\n        console.log(i);\n        form.push(GroupRules(ruleList[i], rules[ruleList[i]], handleSelectChange));\n    }\n    return (\n        <Modal show={showChooseRuleModal} onHide={handleCloseChooseRuleModal} backdrop=\"static\" keyboard={false}>\n            <Modal.Header>\n                <Modal.Title>Choose Rule Form</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n            <Form onSubmit={onSubmit}>\n                    {form}\n                <Button type=\"submit\">Submit</Button>\n            </Form>\n\n        </Modal.Body>\n        </Modal>\n    )\n}\n\nexport default ChooseRuleForm;","import { Button, Form, Modal } from 'react-bootstrap';\nimport { useReducer, useState } from 'react';\nimport { allRulesValid } from \"../../utils/helpers\";\nimport shortid from \"shortid\";\nconst formReducer = (state, event) => {\n  if (event.reset) {\n    return {\n      startingSpikes: 0,\n      rules: '',\n    }\n  }\n  return {\n    ...state,\n    [event.name]: event.value\n  }\n}\n\nconst NewNodeForm = ({ showNewNodeModal, handleCloseModal, handleNewNode, handleError }) => {\n  const handleClose = () => {\n    handleCloseModal();\n  };\n  const [formData, setFormData] = useReducer(formReducer, {});\n  const [submitting, setSubmitting] = useState(false);\n  const handleChange = event => {\n    console.log(event.target.name);\n    setFormData({\n      name: event.target.name,\n      value: event.target.value,\n    });\n  };\n  function handleSubmit(event) {\n    event.preventDefault();\n    let newId = shortid.generate();\n\n    if (allRulesValid(formData.rules)) {\n      console.log(\"All rules valid\");\n      handleClose();\n      setSubmitting(true);\n\n      setTimeout(() => {\n        setSubmitting(false);\n        setFormData({\n          reset: true\n        })\n      }, 3000);\n      const newNeuron = {\n        id: newId,\n        position: { x: 100, y: 100 },\n        rules: formData.rules,\n        startingSpikes: parseInt(formData.startingSpikes),\n        delay: 0,\n        spikes: parseInt(formData.startingSpikes),\n        isOutput: false,\n        out: []\n      }\n      handleNewNode(newNeuron);\n    } else {\n      console.log(\"One or more of the rules is invalid\");\n      handleError(\"One or more of the rules is invalid\");\n      handleClose();\n    };\n  }\n\n  return (\n    <Modal show={showNewNodeModal} onHide={handleClose}>\n      <Modal.Header closeButton>\n        <Modal.Title>Create New Node</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        <Form onSubmit={handleSubmit}>\n          <Form.Group>\n            <Form.Label>Node Rules</Form.Label>\n            <Form.Control required name=\"rules\" type=\"text\" placeholder=\"a/a->a;0 aa/a->a;1\" value={formData.rules} onChange={handleChange} />\n            <Form.Text className=\"text-muted\">\n              Enter valid rules only. Separate each rule with a space.\n              </Form.Text>\n          </Form.Group>\n          <Form.Group>\n            <Form.Label>Starting Spike Number</Form.Label>\n            <Form.Control required name=\"startingSpikes\" type=\"number\" placeholder=\"0\" value={formData.startingSpikes} onChange={handleChange} />\n          </Form.Group>\n          <Button variant=\"secondary\" onClick={handleClose}>\n            Close\n            </Button> {' '}\n          <Button type=\"submit\" variant=\"primary\">\n            Save Changes\n            </Button>\n        </Form>\n      </Modal.Body>\n    </Modal>\n  )\n}\nexport default NewNodeForm;","import { Button, Form, Modal } from 'react-bootstrap';\nimport { useEffect, useReducer, useState } from 'react';\nimport { allRulesValid } from \"../../utils/helpers\";\n\nconst EditNodeForm = ({ showEditModal, handleCloseEditModal, handleEditNode, handleError, neurons }) => {\n    const [neuronId, setNeuronId] = useState('');\n    const [rules, setRules] = useState('');\n    const [startingSpikes, setStartingSpikes] = useState(0);\n    const handleClose = () => {\n        handleCloseEditModal();\n    };\n    useEffect(()=>{\n        firstUpdate();\n    },[]);\n    function firstUpdate(){\n        var filteredObject = Object.keys(neurons).reduce(function(r, e) {\n            if (!neurons[e].isOutput) r[e] = neurons[e];\n            return r;\n        }, {});\n        var keys = Object.keys(filteredObject);\n        setNeuronId(keys[0]);\n        setRules(filteredObject[keys[0]].rules);\n        setStartingSpikes(filteredObject[keys[0]].startingSpikes);\n    }\n    var filteredObject = Object.keys(neurons).reduce(function(r, e) {\n        if (!neurons[e].isOutput) r[e] = neurons[e];\n        return r;\n    }, {});\n    let neuronOptions = Object.keys(filteredObject).map((neuron)=>(\n        <option value={neuron} key={neuron}>{neuron}</option>)\n    )   \n    function handleSelectChange(event){\n        //console.log(event.target.value);\n        let id = event.target.value;\n        setNeuronId(event.target.value);\n        setRules(neurons[id].rules);\n        setStartingSpikes(neurons[id].startingSpikes);\n    }\n    function handleSubmit(event) {\n        event.preventDefault();\n        if (allRulesValid(rules)) {\n            console.log(\"All rules valid\");\n            handleClose();\n            setTimeout(() => {\n                setNeuronId('');\n                setRules('');\n                setStartingSpikes(0);\n            }, 3000);\n            handleEditNode(neuronId, rules, startingSpikes);\n        } else {\n            console.log(\"One or more of the rules is invalid\");\n            handleError(\"One or more of the rules is invalid\");\n        };\n    }\n\n    return (\n        <Modal show={showEditModal} onHide={handleClose}>\n            <Modal.Header closeButton>\n                <Modal.Title>Edit Node</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <Form onSubmit={handleSubmit}>\n                    <Form.Group>\n                        <Form.Label>Select node to edit</Form.Label>\n                        <Form.Control as=\"select\" value={neuronId} onChange={handleSelectChange}>\n                            {neuronOptions}\n                        </Form.Control>\n                    </Form.Group>\n                    <Form.Group>\n                        <Form.Label>Node Rules</Form.Label>\n                        <Form.Control required name=\"rules\" type=\"text\" placeholder=\"a/a->a;0 aa/a->a;1\" value={rules} onChange={(event)=>{setRules(event.target.value)}} />\n                        <Form.Text className=\"text-muted\">\n                            Enter valid rules only. Separate each rule with a space.\n                        </Form.Text>\n                    </Form.Group>\n                    <Form.Group>\n                        <Form.Label>Starting Spike Number</Form.Label>\n                        <Form.Control required name=\"startingSpikes\" type=\"number\" placeholder=\"0\" value={startingSpikes} onChange={(event)=>setStartingSpikes(event.target.value)} />\n                    </Form.Group>\n                    <Button variant=\"secondary\" onClick={handleClose}>\n                        Close\n            </Button> {' '}\n                    <Button type=\"submit\" variant=\"primary\">\n                        Save Changes\n            </Button>\n                </Form>\n            </Modal.Body>\n        </Modal>\n    )\n}\nexport default EditNodeForm;","import { Button, Form, Modal } from 'react-bootstrap';\nimport { useReducer, useState } from 'react';\nimport { allRulesValid } from \"../../utils/helpers\";\n\nconst DeleteNodeForm = ({ showDeleteModal, handleCloseDeleteModal, handleDeleteNode, handleError, neurons }) => {\n    const [neuronId, setNeuronId] = useState(Object.keys(neurons));\n    const handleClose = () => {\n        handleCloseDeleteModal();\n    };\n\n    //console.log(\"it's here\", neurons);\n    //console.log(\"neuron[0]\",Object.keys(neurons));\n    \n    let neuronOptions = Object.keys(neurons).map((neuron)=>(\n        <option value={neuron} key={neuron}>{neuron}</option>)\n    )\n\n    let defaultNeuron = Object.keys(neurons)[0];\n    //console.log(\"defaultNeuron\", defaultNeuron);\n\n    function handleSelectChange(event){\n        //console.log(\"Event.target.value\", event.target.value)\n        setNeuronId(event.target.value);\n    }\n    function handleSubmit(event) {\n        event.preventDefault();\n        //console.log(neurons);\n        if(neuronId!==''){\n            \n            handleClose();\n                setTimeout(() => {\n                    setNeuronId('');\n                }, 3000);\n                handleDeleteNode(neuronId);\n        }else{\n            handleClose();\n                setTimeout(() => {\n                    setNeuronId('');\n                }, 3000);\n                handleDeleteNode(defaultNeuron);\n            //handleError(`Please input a neuron id ${neuronId} none`);\n            //handleClose();\n        }\n    }\n\n    return (\n        <Modal show={showDeleteModal} onHide={handleClose}>\n            <Modal.Header closeButton>\n                <Modal.Title>Delete Node</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <Form onSubmit={handleSubmit}>\n                    <Form.Group>\n                        <Form.Label>Select node to delete</Form.Label>\n                        <Form.Control as=\"select\" defaultValue={defaultNeuron} value={neuronId} onChange={handleSelectChange}>\n                            {neuronOptions}\n                        </Form.Control>\n                    </Form.Group>\n                    <Button variant=\"secondary\" onClick={handleClose}>\n                        Close\n            </Button> {' '}\n                    <Button type=\"submit\" variant=\"danger\">\n                        Delete neuron\n            </Button>\n                </Form>\n            </Modal.Body>\n        </Modal>\n    )\n}\nexport default DeleteNodeForm;","import { Table, Modal } from \"react-bootstrap\"\nimport './ChoiceHistory.css';\nconst ChoiceHistory = ({time,showChoiceHistoryModal,handleCloseHoiceHistoryModal}) =>{\n    var getLatestState = JSON.parse(localStorage.getItem(time-1+\"sec\"));\n    var neuronIds = \"There are no neurons\";\n    if(getLatestState){\n        neuronIds = Object.keys(getLatestState).map((neuron)=>(\n            <th key={neuron}>{neuron}</th>)\n        )\n    }\n    var neuronRows = [];\n    \n    for(var i = 0; i<time; i++){\n        var neuronCells=[];\n        neuronCells.push(TableCell(i));\n        var state = JSON.parse(localStorage.getItem(i+\"sec\"));\n        for(var k in state){\n            if(state[k].chosenRule){\n                neuronCells.push(TableCell(state[k].chosenRule));\n            }else{\n                neuronCells.push(TableCell(\"No chosen rule\"));\n            }\n        }\n        neuronRows.push(TableRow(neuronCells));\n        neuronCells = []\n    }\n    return(\n        <Modal show={showChoiceHistoryModal} onHide={handleCloseHoiceHistoryModal} className=\"custom-choice-history-modal\">\n                <Table striped bordered hover>\n                    <thead>\n                        <tr>\n                            <th>Time</th>\n                            {neuronIds}\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {neuronRows}\n                    </tbody>\n                </Table>\n        </Modal>\n    )\n};\n\nconst TableCell = (content) =>{\n    return(\n        <td>\n            {content}\n        </td>\n    )\n};\n\nconst TableRow = (content)=>{\n    return (\n        <tr>\n            {content}\n        </tr>\n    )\n}\n\nexport default ChoiceHistory;","import { useEffect, useState } from \"react\"\nimport { Prompt } from \"react-router-dom\";\n\nconst useUnsavedChanges = (neurons) =>{\n    const [isDirty, setDirty] = useState(false);\n    const message = \"Are you sure you want to exit without saving your system?\"\n    useEffect(()=>{\n        window.onbeforeunload = isDirty && (() => message);\n        function handleUnsavedChanges (){\n            console.log(\"isDirty:\" + isDirty);\n            if(isDirty){\n                console.log(JSON.stringify(neurons));\n                window.localStorage.setItem('neurons', JSON.stringify(neurons));\n                console.log(JSON.parse(window.localStorage.getItem('neurons')));\n            }\n        }\n\n        window.addEventListener(\"beforeunload\", handleUnsavedChanges);\n        return () => {\n            window.removeEventListener(\"beforeunload\", handleUnsavedChanges);\n            window.onbeforeunload = null;\n        }\n    },[isDirty]);\n    const routerPrompt = <Prompt when={isDirty} message={message} />\n    return [routerPrompt, ()=>setDirty(true), ()=>setDirty(false)];\n}\nexport default useUnsavedChanges;","import './scss/custom.scss';\nimport './App.css';\nimport { slide as Menu } from 'react-burger-menu'\nimport { useState, useEffect, useRef } from \"react\";\nimport { useImmer } from \"use-immer\";\nimport { Button, Container, Alert, Row, Col, Form, OverlayTrigger, Tooltip, Dropdown } from 'react-bootstrap';\nimport { PlayFill, PauseFill, SkipForwardFill, SkipBackwardFill, QuestionCircle, ClockFill, ClockHistory, PlusSquare, Save2 } from 'react-bootstrap-icons';\nimport styled, { css, keyframes } from 'styled-components'\nimport Snapse from \"./components/Snapse/Snapse\";\nimport shortid from 'shortid';\nimport { step, backStep, parseRule } from \"./utils/automata\";\nimport ChooseRuleForm from './components/forms/ChooseRuleForm';\nimport NewNodeForm from './components/forms/NewNodeForm';\nimport EditNodeForm from './components/forms/EditNodeForm';\nimport DeleteNodeForm from './components/forms/DeleteNodeForm';\nimport ChoiceHistory from './components/ChoiceHistory/ChoiceHistory';\nimport convert from 'xml-js';\nimport { HashRouter as Router, Switch, Route } from \"react-router-dom\";\nimport { saveAs } from 'file-saver';\nimport useUnsavedChanges from './components/useUnsavedChanges/useUnsavedChanges';\nimport { original } from 'immer';\nvar options = { compact: true, ignoreComment: true, spaces: 4, sanitize: false };\nvar keypresses = 0;\nvar originalNeurons = (window.localStorage.getItem('neurons') != null) ?  JSON.parse(window.localStorage.getItem('neurons')) : {\n  n1: {\n    id: \"n1\",\n    position: { x: 50, y: 50 },\n    rules: 'a+/a->a;2',\n    startingSpikes: 1,\n    delay: 0,\n    spikes: 1,\n    isOutput: false,\n    out: ['n2']\n  },\n  n2: {\n    id: \"n2\",\n    position: { x: 200, y: 50 },\n    rules: 'a/a->a;1',\n    startingSpikes: 0,\n    delay: 0,\n    spikes: 0,\n    isOutput: false,\n    out: ['n3']\n  },\n  n3: {\n    id: \"n3\",\n    position: { x: 400, y: 50 },\n    rules: 'a/a->a;0',\n    startingSpikes: 1,\n    delay: 0,\n    spikes: 1,\n    isOutput: false,\n    out: [\"n4\"]\n  },\n  n4: {\n    id: \"n4\",\n    position: { x: 400, y: 200 },\n    isOutput: true,\n    spikes: 0,\n    bitstring: ' '\n  }\n};\n\nconst useKey = (key, cb) => {\n  const callbackRef = useRef(cb); \n\n  useEffect(() => {\n    callbackRef.current = cb;\n  });\n  useEffect(()=> {\n    function debounced(delay, fn) {\n      let timerId;\n      return function (...args) {\n        if (timerId) {\n          clearTimeout(timerId);\n        }\n        timerId = setTimeout(() => {\n          fn(...args);\n          timerId = null;\n        }, delay);\n      }\n    }\n\n    function handleKeyDown(event){\n      if(event.code === key){\n        keypresses++; \n        console.log(\"Key presses:\" + keypresses);\n        console.log(\"Key pressed: \" + event.code);\n        callbackRef.current(event);\n      }\n    }\n\n    document.addEventListener(\"keydown\", (event) => {event.preventDefault();});\n    document.addEventListener(\"keydown\", debounced(300, handleKeyDown));\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  }, [key]);\n}\n\nfunction App() {\n  const [neurons, setNeurons] = useImmer(originalNeurons);\n  const [time, setTime] = useState(0);\n  const [isRandom, setIsRandom] = useState(true);\n  const [fileName, setFileName] = useState('');\n  const [Prompt, setDirty, setPristine] = useUnsavedChanges(neurons);\n  const [showNewNodeModal, setShowNewNodeModal] = useState(false);\n  const [showChooseRuleModal, setShowChooseRuleModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [showChoiceHistoryModal, setShowChoiceHistoryModal] = useState(false);\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [hasEnded, setHasEnded] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [pBar, setPBar] = useState(0);\n  const handleClose = () => setShowNewNodeModal(false);\n  const handleShow = () => setShowNewNodeModal(true);\n  const handleCloseEditModal = () => setShowEditModal(false);\n  const handleShowEditModal = () => setShowEditModal(true);\n  const handleCloseDeleteModal = () => setShowDeleteModal(false);\n  const handleShowDeleteModal = () => setShowDeleteModal(true);\n  const handleCloseChooseRuleModal = () => setShowChooseRuleModal(false);\n  const handleShowChoiceHistoryModal = () => setShowChoiceHistoryModal(true);\n  const handleCloseHoiceHistoryModal = () => setShowChoiceHistoryModal(false);\n  const handleSimulationEnd = () => {\n    setHasEnded(true);\n    setIsPlaying(false);\n    console.log(\"alert from simulationEnd\");\n    alert(\"Simulation has ended.\");\n  }\n  const showError = (text) => {\n    setError(text);\n    setTimeout(() => {\n      setError(\"\");\n    }, 3000);\n  }\n  const handleSave = () => {\n    //Convert JSON Array to string.\n    var wrapper = { content: neurons };\n    //console.log(neurons);\n    var result = convert.json2xml(wrapper, options);\n    //console.log(wrapper);\n    var blob = new Blob([result], { type: \"text/xml;charset=utf-8\", });\n    saveAs(blob, Date().toString() + \"-Neurons.xmp\");\n    setPristine();\n  }\n  const handleLoad = (input) => {\n    let file = input.files[0];\n    setHasEnded(false);\n\n    if (file.type && file.type.indexOf('text/xml') === -1) {\n\n      showError(\"File is not a xml file\");\n      return;\n    }\n    const reader = new FileReader();\n    function nativeType(value) {\n      var nValue = Number(value);\n      if (!isNaN(nValue)) {\n        return nValue;\n      }\n      var bValue = value.toLowerCase();\n      if (bValue === 'true') {\n        return true;\n      } else if (bValue === 'false') {\n        return false;\n      }\n      return value;\n    }\n    var removeJsonTextAttribute = async function (value, parentElement) {\n      try {\n        const parentOfParent = parentElement._parent;\n        const pOpKeys = Object.keys(parentElement._parent);\n        const keyNo = pOpKeys.length;\n        const keyName = pOpKeys[keyNo - 1];\n        const arrOfKey = parentElement._parent[keyName];\n        const arrOfKeyLen = arrOfKey.length;\n        if (arrOfKeyLen > 0) {\n          const arr = arrOfKey;\n          const arrIndex = arrOfKey.length - 1;\n          arr[arrIndex] = value;\n        } else if (keyName == \"out\") {\n          parentElement._parent[keyName] = [value];\n        } else if (keyName == \"bitstring\") {\n          console.log(\"bitstring\");\n          parentElement._parent[keyName] = \"\";\n        }\n        else {\n          parentElement._parent[keyName] = nativeType(value);\n        }\n\n      } catch (e) { }\n    }\n    reader.addEventListener('load', async (event) => {\n      var options = {\n        compact: true,\n        trim: true,\n        ignoreDeclaration: true,\n        ignoreInstruction: true,\n        ignoreAttributes: true,\n        ignoreComment: true,\n        ignoreCdata: true,\n        ignoreDoctype: true,\n        textFn: removeJsonTextAttribute\n      };\n      var result = await convert.xml2js(event.target.result, options);\n      console.log(\"Result.content\"); \n      await setNeurons(draft => draft = result.content);\n      await setNeurons(draft => {\n        for (var k in draft) {\n          if (draft[k].bitstring) {\n            console.log(draft[k].bitstring);\n            draft[k].bitstring = \" \";\n          }\n        }\n      })\n      originalNeurons = result.content;\n      setFileName(file.name);\n    });\n    reader.readAsText(file);\n    setTime(0);\n  }\n\n  const onEdgeCreate = async (src, dst) => {\n    console.log(\"newEdge\", src, dst);\n    await setNeurons(draft => {\n      var outCopy = [...draft[src].out];\n      outCopy.push(dst)\n      draft[src].out = outCopy;\n    })\n\n\n  }\n  const handleNewPosition = async (position, id) => {\n    setNeurons(draft => {\n      draft[id].position = position;\n    });\n    setDirty();\n\n  }\n  async function handleNewNode(newNeuron) {\n    await setNeurons(draft => {\n      draft[newNeuron.id] = newNeuron;\n    })\n  }\n  async function handleNewOutput() {\n    await setNeurons(draft => {\n      var newId = shortid.generate()\n      draft[newId] = {\n        id: newId,\n        position: { x: 300, y: 300 },\n        isOutput: true,\n        spikes: 0,\n        bitstring: ' '\n      }\n    });\n    setDirty();\n  }\n  async function handleEditNode(id, rules, spikes) {\n    //console.log(\"handleEditNode\")\n    await setNeurons(draft => {\n      draft[id].startingSpikes = spikes;\n      draft[id].spikes = spikes;\n      draft[id].rules = rules;\n    });\n    setDirty();\n    originalNeurons = neurons; //for restart\n    window.localStorage.setItem('neurons', JSON.stringify(neurons));\n  }\n  async function handleDeleteNode(neuronId) {\n    console.log(\"handleDeleteNode\", neuronId);\n    setDirty();\n    await setNeurons(draft => {\n      //first delete edges connected to neuron\n      for (var k in draft) {\n        var neuron = draft[k];\n\n        if (!neuron.isOutput) {\n          const neuronOutKeys = neuron.out;\n          let arr = neuron.out.filter(function (item) {\n            return item !== neuronId\n          });\n          draft[k].out = arr;\n        }\n      }\n      //delete neuron\n      delete draft[neuronId];\n    })\n    console.log(neurons);\n    originalNeurons = neurons;\n    window.localStorage.setItem('neurons', JSON.stringify(neurons));\n  }\n  function handlePlay() {\n    if (!hasEnded){\n      setIsPlaying(p => !p);\n    }else{\n      alert(\"Simulation has ended.\");\n    }\n  }\n  const renderTooltip = (props) => (\n    <Tooltip id=\"button-tooltip\" {...props}>\n      Pseudorandom will allow the system to decide which rule will be executed. Unchecking it will let you decide.\n    </Tooltip>\n  );\n  const handleReset = () => {\n    setNeurons(draft => draft = originalNeurons);\n    setTime(0);\n    setIsPlaying(false);\n    setHasEnded(false);\n    localStorage.clear();\n  }\n  const [guidedRules, setGuidedRules] = useState({});\n  const handleStartGuidedMode = async (rules) => {\n    await setGuidedRules(rules);\n\n    console.log(rules);\n    setShowChooseRuleModal(true);\n    if (setShowChooseRuleModal) {\n      setIsPlaying(false); //pauses the graph playing while choosing rule\n    }\n  }\n  const handleChosenRules = (data) => {\n    handleCloseChooseRuleModal();\n    setNeurons((draft) => {\n      for (var j in draft) {\n        for (var k in data) {\n          if (j == k) {\n            var [requires, grouped, symbol, consumes, produces, delay] = parseRule(data[k]);\n            draft[j].delay = delay\n            //console.log(data[k]);\n            draft[j].currentRule = data[k];\n            draft[j].chosenRule = data[k];\n          }\n        }\n      }\n    });\n    setIsPlaying(true); // continue playing after choosing rule\n  }\n  const onForward = async () => {\n    if (time == 0) {\n      //copy\n      console.log(\"Time is: \" + time);\n      originalNeurons = JSON.parse(JSON.stringify(neurons));\n    }\n    if (!hasEnded) {\n      await setNeurons(neurons => step(neurons, time, isRandom, handleStartGuidedMode, handleSimulationEnd));\n      setTime(time => time + 1);\n    }else{\n      alert(\"Simulation has ended.\");\n    } \n  }\n  const onBackward = async () => {\n    if (time > 1) {\n      var tempTime = time.valueOf();\n      setHasEnded(false);\n      await setNeurons(neurons => backStep(tempTime - 2));\n      await setTime(time => time - 1);\n\n    }\n    else if (time == 1) {\n      handleReset();\n    }\n\n  }\n  const neuronsRef = useRef(neurons)\n  neuronsRef.current = neurons\n  const onIntervalStepRef = useRef(onForward)\n  onIntervalStepRef.current = () => {\n    onForward();\n    setPBar(p => p + 1);\n  }\n  useEffect(() => {\n    if (isPlaying) {\n      var interval = setInterval(() => {\n        onIntervalStepRef.current()\n      }, 3000)\n    }\n    return () => clearInterval(interval);\n  }, [isPlaying, onIntervalStepRef])\n\n  useEffect(() => {\n    if (showChooseRuleModal) {\n      console.log(\"showChooseRuleModal is true\");\n    }\n  }, [])\n\n    // Key Bindings \n    function handleSpace(){\n      console.log(\"Space Pressed\");\n      setIsPlaying(p => !p);\n    }\n  \n    function handleRightKey(){\n      console.log(\"Right Key Pressed\");\n      if(!hasEnded){\n        onIntervalStepRef.current();\n      }\n    }\n  \n    function handleLeftKey(){\n      console.log(\"Left Key Pressed\");\n      onBackward();\n    }\n  \n    useKey(\"Space\", handleSpace);\n    useKey(\"ArrowLeft\", handleLeftKey);\n    useKey(\"ArrowRight\", handleRightKey);\n  \n\n  return (\n    <Router>\n      <Switch>\n        <Route path=\"/\">\n          <Container>\n            {error && <Alert variant=\"danger\">\n              {error}\n            </Alert>}\n            <Menu>\n              <Dropdown>\n              <Dropdown.Toggle id=\"dropdown-basic\">\n                <PlusSquare/>{' '}Node Actions\n              </Dropdown.Toggle>\n              <Dropdown.Menu>\n              <Dropdown.Item><Button variant=\"link\" size=\"sm\" className=\"node-actions text-primary\" onClick={handleShow} disabled={time > 0 ? true : false}>New Node</Button></Dropdown.Item>\n                <Dropdown.Item><Button variant=\"link\" size=\"sm\" className=\"node-actions text-primary\" onClick={handleNewOutput} disabled={time > 0 ? true : false}>New Output Node</Button></Dropdown.Item>\n                <Dropdown.Item><Button variant=\"link\" size=\"sm\" className=\"node-actions text-info\" onClick={handleShowEditModal} disabled={time > 0 ? true : false}>Edit</Button></Dropdown.Item>\n                <Dropdown.Item><Button variant=\"link\" size=\"sm\" className=\"node-actions text-danger\" onClick={handleShowDeleteModal} disabled={time > 0 ? true : false}>Delete</Button></Dropdown.Item>\n              </Dropdown.Menu>\n              </Dropdown>\n              <Form>\n                <Form.File\n                  id=\"custom-file\"\n                  label={fileName ? fileName : \"Load file...\"}\n                  custom\n                  onChange={(e) => { handleLoad(e.target) }}\n                />\n              </Form>\n              <div>\n                <Button variant=\"primary\" disabled={time > 0 ? true : false} onClick={handleSave}><Save2/>{' '}Save</Button>\n              </div>\n              <div>\n                <Button variant=\"primary\" onClick={handleShowChoiceHistoryModal}><ClockHistory/>{' '}Choice History</Button>\n              </div>\n            </Menu>\n            <div>\n            <div style={{ textAlign: \"center\" }}>\n              <h1 style={{ fontWeight: \"700\"}} className=\"text-primary\">WebSnapse</h1>\n            </div>\n            <Row>\n              <Col>\n                <div>\n                  <div style={{backgroundColor:\"#778beb\", color:\"white\", borderRadius:\"10px\", padding:\"0.5em\"}}>\n                  <ClockFill color=\"white\" size={30}/> <strong>Time:</strong> {time == 0 ? \"Start playing!\" : time}\n                  </div>\n                  <Form>\n                    <Form.Group id=\"formGridCheckbox\">\n                      <Row>\n                        <Col sm={5}>\n                          <Form.Check type=\"checkbox\"\n                            label=\"Pseudorandom\"\n                            defaultChecked={isRandom}\n                            onChange={() => {\n                              setIsRandom(!isRandom)\n                            }} />\n                        </Col>\n\n                        <Col sm={1} style={{ textAlign: \"left\" }}>\n                          <OverlayTrigger\n                            placement=\"right\"\n                            delay={{ show: 250, hide: 400 }}\n                            overlay={renderTooltip}\n                          >\n                            <QuestionCircle />\n                          </OverlayTrigger>\n                        </Col>\n                      </Row>\n                    </Form.Group>\n                  </Form>\n\n                </div>\n              </Col>\n              <Col><div className=\"snapse-controls\" style={{ textAlign: \"center\" }}>\n                <Button variant=\"link\" onClick={onBackward}><SkipBackwardFill /></Button>{' '}\n                <div style={{ display: 'inline-block' }}>\n                  <ProgressBar key={pBar} isPlaying={isPlaying} />\n                  <Button size=\"lg\" className=\"snapse-controls-play\" onClick={handlePlay}>{isPlaying ? <PauseFill /> : <PlayFill />}</Button>\n                </div> {' '}\n                <Button variant=\"link\" onClick={() => onForward()}><SkipForwardFill /></Button>{' '}\n\n              </div>\n              </Col>\n              <Col style={{textAlign:\"right\"}}><Button variant=\"danger\" onClick={handleReset}>Restart</Button>{' '}</Col>\n            </Row>\n            </div>\n            <hr />\n            <Snapse\n              neurons={neurons}\n              onEdgeCreate={(src, dst, addedEles) => {\n                onEdgeCreate(src.id(), dst.id())\n                addedEles.remove();\n              }}\n              handleChangePosition={handleNewPosition} />\n            <ChoiceHistory time={time}\n            showChoiceHistoryModal={showChoiceHistoryModal}\n            handleCloseHoiceHistoryModal={handleCloseHoiceHistoryModal} />\n            <NewNodeForm showNewNodeModal={showNewNodeModal}\n              handleCloseModal={handleClose}\n              handleNewNode={handleNewNode}\n              handleError={showError} />\n            <EditNodeForm showEditModal={showEditModal}\n              handleCloseEditModal={handleCloseEditModal}\n              handleEditNode={handleEditNode}\n              handleError={showError}\n              neurons={neurons} />\n            <DeleteNodeForm showDeleteModal={showDeleteModal}\n              handleCloseDeleteModal={handleCloseDeleteModal}\n              handleDeleteNode={handleDeleteNode}\n              handleError={showError}\n              neurons={neurons}\n            />\n            <ChooseRuleForm showChooseRuleModal={showChooseRuleModal}\n              handleCloseChooseRuleModal={handleCloseChooseRuleModal}\n              rules={guidedRules}\n              handleChosenRules={handleChosenRules}\n            />\n            {Prompt}\n          </Container>\n        </Route>\n      </Switch>\n    </Router>\n  );\n}\n\nconst shortening = keyframes`\n  from {\n    transform: scaleX(100%);\n  }\n\n  to {\n    transform: scaleX(0%);\n  }\n`\nconst ProgressBar = styled.div`\n  ${props =>\n    props.isPlaying &&\n    css`\n      animation: ${shortening} 3s linear; \n    `}\n  background-color: #c44569;\n  height: 4px;\n  transform-origin: left center;\n  margin-bottom: 2px;\n`\n\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport cytoscape from 'cytoscape';\nimport edgehandles from 'cytoscape-edgehandles';\nimport gridGuide from 'cytoscape-grid-guide';\n\ncytoscape.use(edgehandles)\ncytoscape.use(gridGuide)\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}