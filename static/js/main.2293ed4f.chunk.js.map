{"version":3,"sources":["components/stylesheet.js","components/Snapse/useAnimateEdges.js","utils/helpers.js","components/Snapse/Snapse.js","utils/automata.js","components/forms/ChooseRuleForm.js","components/forms/NewNodeForm.js","components/forms/NewOutputNodeForm.js","components/forms/EditNodeForm.js","components/forms/DeleteNodeForm.js","components/ChoiceHistory/ChoiceHistory.js","components/useUnsavedChanges/useUnsavedChanges.js","App.js","reportWebVitals.js","index.js"],"names":["styles","selector","style","color","content","events","height","shape","width","useAnimateEdges","cyRef","useRef","useEffect","raf","cy","current","animOffset","animate","edges","requestAnimationFrame","cancelAnimationFrame","internal","createOutputNeuron","id","x","y","output","spike","data","rootId","label","includes","substr","indexOf","classes","position","parent","checkValidRule","rule","result","exec","console","log","createEdge","src","dst","c","source","target","allRulesValid","rules","splitRules","split","count","i","length","Snapse","neurons","onEdgeCreate","handleChangePosition","setCy","elements","newId","time","array","nodes","k","element","isOutput","newOutputNode","bitstring","push","newNodes","spikes","delay","replace","out","newEdge","newEdges","convertElements","on","evt","gridGuide","guidelinesStyle","strokeStyle","horizontalDistColor","verticalDistColor","initPosAlignmentColor","edgehandles","handleNodes","preview","loopAllowed","edgeType","sourceNode","targetNode","complete","Button","className","variant","onClick","center","fit","zoom","level","CytoscapeComponent","normalizeElements","stylesheet","parseRule","testRes","forgetRes","requires","grouped","symbol","consumes","produces","delayStr","parseInt","canUseRule","step","isRandom","handleStartGuidedMode","handleSimulationEnd","newStates","produce","draft","spikeAdds","outputTracker","neuronValidRules","shouldEnd","neuron","currentRule","validRules","chosenRule","randomIndex","Math","floor","random","Object","keys","newDelay","valueOf","newSpikes","neuronOutKeys","newString","localStorage","setItem","JSON","stringify","backStep","parse","getItem","ChooseRuleForm","showChooseRuleModal","handleCloseChooseRuleModal","handleChosenRules","useImmer","values","setValues","handleSelectChange","event","neuronId","currentValues","value","GroupRules","options","neuronOptions","map","Form","Group","Label","Control","as","onChange","ruleList","form","Modal","show","onHide","backdrop","keyboard","Header","Title","Body","onSubmit","e","preventDefault","type","formReducer","state","reset","startingSpikes","name","initialFormState","NewNodeForm","showNewNodeModal","handleCloseModal","handleNewNode","handleError","handleClose","useReducer","formData","setFormData","useState","setSubmitting","handleChange","closeButton","shortid","generate","setTimeout","newNeuron","required","placeholder","Text","NewOutputNodeForm","showNewOutputModal","handleCloseNewOutputModal","handleNewOutput","EditNodeForm","showEditModal","handleCloseEditModal","handleEditNode","setNeuronId","setRules","setStartingSpikes","filteredObject","reduce","r","firstUpdate","DeleteNodeForm","showDeleteModal","handleCloseDeleteModal","handleDeleteNode","defaultNeuron","TableCell","TableRow","ChoiceHistory","showChoiceHistoryModal","handleCloseHoiceHistoryModal","getLatestState","neuronIds","neuronRows","neuronCells","Table","striped","bordered","hover","useUnsavedChanges","isDirty","setDirty","message","window","onbeforeunload","when","compact","ignoreComment","spaces","sanitize","useKey","key","cb","isFocus","callbackRef","inputs","document","getElementsByTagName","input","addEventListener","handleKeyDown","code","fn","timerId","args","clearTimeout","debounced","removeEventListener","shortening","keyframes","ProgressBar","styled","div","props","isPlaying","css","App","n1","n2","n3","n4","setNeurons","setTime","setIsRandom","fileName","setFileName","Prompt","setPristine","setShowNewNodeModal","setShowNewOutputModal","setShowChooseRuleModal","setShowEditModal","setShowChoiceHistoryModal","setShowDeleteModal","setIsPlaying","hasEnded","setHasEnded","error","setError","pBar","setPBar","alert","showError","text","a","outCopy","handleNewPosition","newOutput","arr","filter","item","handleReset","tempNeurons","clear","guidedRules","setGuidedRules","onForward","onBackward","tempTime","onIntervalStepRef","p","interval","setInterval","clearInterval","path","Container","Alert","File","custom","file","files","reader","FileReader","removeJsonTextAttribute","parentElement","_parent","pOpKeys","keyNo","keyName","arrOfKey","arrIndex","nativeType","trim","ignoreDeclaration","ignoreInstruction","ignoreAttributes","ignoreCdata","ignoreDoctype","textFn","convert","xml2js","readAsText","nValue","Number","isNaN","bValue","toLowerCase","handleLoad","disabled","wrapper","json2xml","blob","Blob","saveAs","Date","toString","textAlign","fontWeight","Row","Col","sm","Check","defaultChecked","OverlayTrigger","placement","hide","overlay","Tooltip","backgroundColor","borderRadius","padding","size","marginBottom","display","Dropdown","Toggle","Menu","Item","addedEles","remove","j","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","cytoscape","use","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.2293ed4f.chunk.js","sourcesContent":["const styles = [\n    {\n        selector: '.snapse-node, .snapse-output',\n        style: {\n            'font-family': 'Computer Modern',\n            'background-opacity': '0',\n            'padding-top': '0',\n            'border-width': 0,\n            'text-halign': 'left',\n            'text-valign': 'top',\n            color: 'black',\n            content: 'data(label)'\n        }\n    },\n    {\n        selector: '.snapse-node__rules, .snapse-node__output',\n        style: {\n            'font-family': 'Computer Modern',\n            'font-style':'italic',\n            'background-color': 'white',\n            'border-width': 1,\n            events: 'no',\n            'text-wrap': 'wrap',\n            'text-halign': 'center',\n            'text-valign': 'center',\n            'text-wrap':'wrap',\n            content: 'data(label)',\n            height: 150,\n            shape: 'roundrectangle',\n            width: 100\n        }\n    },\n    {\n        selector: '.snapse-node__time, .snapse-node__spike',\n        style: {\n            'font-family': 'Computer Modern',\n            'background-opacity': '0',\n            'text-halign': 'center',\n            'text-valign': 'center',\n            content: 'data(label)',\n            events: 'no',\n            height: 15,\n            shape: 'roundrectangle',\n            width: 50\n        }\n    },\n    /*     {\n            selector: 'node',\n            style: {\n                'background-opacity': '0',\n                'padding-top': '0',\n                'text-halign': 'left',\n                'text-valign': 'top',\n                color: 'black',\n                content: 'data(label)',\n                'border-width': 1,\n                events: 'no',\n                'text-wrap': 'wrap',\n                shape: 'roundrectangle'\n            }\n        }, */\n    {\n        selector: 'edge',\n        style: {\n            'font-family': 'Computer Modern',\n            'curve-style': 'bezier',\n            'target-arrow-shape': 'triangle',\n            'text-background-color': 'white',\n            'text-background-shape': 'rectangle',\n            width: 1\n        }\n    },\n    {\n        selector: '.edge--triggering',\n        style: {\n          'line-color': 'magenta',\n          'line-style': 'dashed',\n          'target-arrow-color': 'magenta',\n          width: 3\n        }\n    }\n]\nexport default styles;\n","import { useEffect, useRef } from 'react'\nimport cytoscapejs from 'cytoscape'\n\nfunction useAnimateEdges() {\n  const cyRef = useRef(null)\n  const setCy = (internal) => {\n    cyRef.current = internal\n  }\n\n  useEffect(() => {\n    const cy = cyRef.current\n    let raf\n    let animOffset = 0\n\n    function animate() {\n      animOffset++\n      if (cy) {\n        cy.edges().animate({\n          style: { 'line-dash-offset': -animOffset }\n        })\n      }\n      raf = requestAnimationFrame(animate)\n    }\n\n    animate()\n\n    return () => {\n      if (raf) {\n        cancelAnimationFrame(raf)\n      }\n    }\n  }, [])\n\n  return [cyRef, setCy]\n}\n\nexport default useAnimateEdges\n","export const createNeuron = (newId, x,\n    y,\n    rules,\n    spike,\n    time) => [{\n        data: {\n            id: newId,\n            label: `${(newId.includes('-'))? newId.substr(0, newId.indexOf('-')) : newId}`\n        },\n        position: { x: x, y: y },\n        classes: 'snapse-node'\n    },\n    {\n        data: {\n            id: newId + '-rules',\n            parent:newId,\n            label: rules.replace(/ /g, \"\\n\")\n        },\n        position: { x: x, y: y },\n        classes: 'snapse-node__rules'\n    },\n    {\n        data: {\n            id: newId + '-spike',\n            parent: newId,\n            label: `${(spike==0)? \"Î»\" : spike}`\n        },\n        position: { x: x, y: y - 60 },\n        classes: 'snapse-node__spike'\n    },\n    {\n        data: {\n            id: newId + '-time',\n            parent: newId,\n            label: time\n        },\n        position: { x: x, y: y + 90 },\n        classes: 'snapse-node__time'\n    }];\nexport const createOutputNeuron = (id,x,y,output,spike) => [\n    {\n        data: { rootId: id, id: `${id}`, label: `${(id.includes('-'))? id.substr(0, id.indexOf('-')) : id}`},\n        classes: 'snapse-output',\n        position: { x: 0, y: 0 }\n      },\n      {\n        data: { rootId: id, id: `${id}-output`, parent: id, label: output },\n        classes: 'snapse-node__output',\n        position: { x, y: y }\n      },\n      {\n        data: { rootId: id, id: `${id}-spike`, parent: id, label: spike },\n        classes: 'snapse-node__spike',\n        position: { x, y: y + 40 }\n      }\n]\nexport const checkValidRule = (rule) =>{\n    const re = /(a+)(\\+*\\**)\\/(a+)->(a+);([0-9]+)/\n    const testRe = /(a+)(\\(*a*\\)*)(\\+*\\**)\\/(a+)->(a+);([0-9]+)/\n    const forgetRe=/(a+)(\\+*\\**)\\/(a+)->(0);(0)/\n    var result = testRe.exec(rule) || forgetRe.exec(rule);\n    console.log(result);    \n    return result;\n}\n\nexport const createEdge = (src,dst,c) =>{\n    return {\n        data: {\n          id: src + '-' + dst,\n          source: src,\n          target: dst\n        },\n        classes: c\n      };\n}\n\nexport const allRulesValid = (rules) => {\n    var splitRules = rules.split(\" \");\n    var count = 0;\n    for (var i=0;i<splitRules.length;i++){\n        if(checkValidRule(splitRules[i])!=null){\n            count+=1;\n        }else{\n            console.log(\"invalidRule\", splitRules[i])\n        }\n    }\n    if(count == splitRules.length){\n        return 1;\n    }else{\n        return 0;\n    }\n}\n\nexport const convertElements = elements =>{\n    var array = {\n        nodes: [],\n        edges:[],\n    }\n    for (var k in elements) {\n        var element = elements[k];\n        //console.log(element);\n        if(!element.isOutput){\n            var newNodes = createNeuron(element.id, element.position.x,element.position.y,element.rules, element.spikes, element.delay);\n            array.nodes.push(newNodes[0])\n            array.nodes.push(newNodes[1])\n            array.nodes.push(newNodes[2])\n            array.nodes.push(newNodes[3])\n            \n        }else{\n            var newOutputNode = createOutputNeuron(element.id, element.position.x,element.position.y, element.bitstring, 0);\n            array.nodes.push(newOutputNode[0])\n            array.nodes.push(newOutputNode[1])\n            array.nodes.push(newOutputNode[2])\n        } \n        if(element.out){\n            for (var i=0; i< element.out.length; i++){\n                if (element.delay<0) {\n                    console.log(element.delay)\n                    for (let out of element.out) {\n                      var newEdge = createEdge(element.id, element.out[i],' edge--triggering');\n                      array.edges.push(newEdge);\n                    }\n                }else{\n                    var newEdges = createEdge(element.id, element.out[i],'');\n                    array.edges.push(newEdges);\n                }\n            }\n        }\n    }\n    return array;\n}\n","\nimport CytoscapeComponent from 'react-cytoscapejs';\nimport stylesheet from '../stylesheet'\nimport {Button, Container} from 'react-bootstrap';\nimport useAnimateEdges from './useAnimateEdges';\nimport { useEffect, useMemo } from 'react';\nimport { convertElements } from '../../utils/helpers';\nimport {AlignCenter} from 'react-bootstrap-icons';\n\nconst Snapse = ({ neurons, onEdgeCreate, handleChangePosition }) => {\n  const [cyRef, setCy] = useAnimateEdges()\n  function handleCenterGraph(){\n    const cy = cyRef.current;\n    if(cy){\n      cy.center();\n      cy.fit();\n      cy.zoom({\n        level: 0.8,\n        position: { x: 100, y: 100 }\n      });\n    }\n  }\n  const elements = convertElements(neurons);\n  useEffect(()=>{\n    const cy = cyRef.current\n    if(cy){\n      cy.on('mouseup','.snapse-node, .snapse-output',(evt)=>{\n        console.log(\"change position\", evt.target.id())\n        handleChangePosition(evt.position, evt.target.id());\n      })\n      cy.gridGuide({\n        guidelinesStyle: {\n        strokeStyle: \"black\",\n        horizontalDistColor: \"#ff0000\",\n        verticalDistColor: \"green\",\n        initPosAlignmentColor: \"#0000ff\",\n        }\n      });\n      cy.edgehandles({\n        handleNodes: '.snapse-node',\n        preview: false,\n        loopAllowed: () => false,\n        edgeType: function (sourceNode, targetNode) {\n          return 'flat'\n          //return sourceNode.edgesTo(targetNode).empty() ? 'flat' : undefined\n        },\n        complete: onEdgeCreate\n      });\n\n    }\n  },[cyRef]);\n  return (\n    <div style={{\n      width: \"100%\",\n      height: \"100%\"\n    }}>\n      <Button className=\"center-graph-button\" variant=\"secondary\" onClick={handleCenterGraph}><AlignCenter/>{' '}Center Graph</Button>\n    <CytoscapeComponent\n      cy={setCy}\n      elements={CytoscapeComponent.normalizeElements(elements)}\n      style={{\n        width: \"100%\",\n        height: \"100%\"\n      }}\n      stylesheet={stylesheet} />\n    </div>\n  )\n};\n\nexport default Snapse;","import produce from 'immer'\nexport function parseRule(rule){\n    const re = /(a+)(\\+*\\**)\\/(a+)->(a+);([0-9]+)/\n    const forgetRe=/(a+)(\\(*a*\\)*)(\\+*\\**)\\/(a+)->(0);(0)/\n    const testRe = /(a+)(\\(*a*\\)*)(\\+*\\**)\\/(a+)->(a+);([0-9]+)/\n    const res = re.exec(rule)\n    const testRes = testRe.exec(rule);\n    const forgetRes = forgetRe.exec(rule);\n    \n    /* if (res) {\n      const [, requires, symbol, consumes, produces, delayStr] = res\n      const delay = parseInt(delayStr, 10)\n      return[requires.length, symbol, consumes.length, produces.length, delay];\n    } */\n    if (testRes) {\n        //console.log(testRes);\n        const [, requires, grouped, symbol, consumes, produces, delayStr] = testRes\n        const delay = parseInt(delayStr, 10)\n        return[requires.length, grouped.length-2, symbol, consumes.length, produces.length, delay];\n    }else if(forgetRes){\n        const [, requires,grouped, symbol,consumes, produces, delayStr] = forgetRes;\n        return [requires.length,grouped.length-2, symbol, consumes.length, 0, 0];\n    }\n    \n\n    return false\n}\nexport function canUseRule(requires, grouped, symbol, spikes){\n    if(symbol == '+'){\n        if(grouped > 0){\n            if ( (spikes - requires) % grouped == 0 && (spikes-requires) >= grouped){\n                return true;\n            }\n            return false;\n        }\n        if (spikes >= requires){\n            return true\n        }\n    }\n    else if(symbol == '*'){\n        if(grouped > 0){\n            if ( (spikes - requires) % grouped == 0){\n                return true;\n            }\n            return false;\n        }\n        if (spikes >= requires-1){\n            return true\n        }\n    }\n    else if(spikes==requires){\n        return true;\n    }\n    return false;\n}\nexport function step(neurons,time,isRandom, handleStartGuidedMode, handleSimulationEnd){\n    const newStates = produce(neurons, draft =>{\n        const spikeAdds = {}\n        const outputTracker = [];\n        var neuronValidRules = {};\n        var shouldEnd = true; \n\n        for (var k in draft){\n            var neuron = draft[k];\n            //choose rule to follow if not working on a rule currently\n            if(!neuron.currentRule && !neuron.isOutput){\n                delete draft[neuron.id].currentRule;\n                //pick a rule\n                var rules = neuron.rules.split(' ');\n                var validRules=[];\n                for (var i=0;i<rules.length;i++){\n                    var [requires, grouped, symbol, consumes, produces, delay] = parseRule(rules[i]);\n                    if(canUseRule(requires,grouped,symbol,neuron.spikes)){\n                        validRules.push(rules[i]);\n                        shouldEnd = false;\n                    }\n                }   \n                if(validRules.length == 1){\n                    draft[neuron.id].currentRule = validRules[0];\n                    draft[neuron.id].chosenRule = validRules[0];\n                    var [requires, grouped, symbol, consumes, produces, delay] = parseRule(validRules[0]);\n                    draft[neuron.id].delay = delay\n                }else if(isRandom == true && validRules.length > 1){\n                    var randomIndex = Math.floor(Math.random() * (validRules.length)) \n                    var [requires, grouped, symbol, consumes, produces, delay] = parseRule(validRules[randomIndex]);\n                    draft[neuron.id].currentRule = validRules[randomIndex];\n                    draft[neuron.id].chosenRule = validRules[randomIndex];\n                    draft[neuron.id].delay = delay\n                }else if(isRandom == false && validRules.length > 1){ \n                    neuronValidRules[neuron.id] = validRules;\n                }\n                \n            }\n        }\n        if(Object.keys(neuronValidRules).length > 0){\n            //console.log(neuronValidRules);\n            handleStartGuidedMode(neuronValidRules);\n            return;\n        }\n        for (var k in draft){\n            var neuron = draft[k];\n            //work on the rule\n            if(neuron.currentRule){\n                shouldEnd = false;\n                if(neuron.delay >= 0){\n                    let newDelay = neuron.delay.valueOf();\n                    newDelay--;\n                    draft[neuron.id].delay = newDelay;\n                }\n                console.log(neuron.delay)\n                if(neuron.delay < 0){\n                    //consume spikes\n                    var [requires, grouped, symbol, consumes, produces, delay] = parseRule(neuron.currentRule);\n                    let newSpikes = neuron.spikes.valueOf();\n                    newSpikes-=consumes;\n                    draft[neuron.id].spikes = newSpikes;\n                    //send spikes\n                    const neuronOutKeys = neuron.out;\n                    for (let k of neuronOutKeys) {\n                    spikeAdds[k] =\n                        k in spikeAdds ? spikeAdds[k] + produces : produces\n                    }\n                    //resolve rule\n                    delete draft[neuron.id].currentRule;\n                } \n            } else if(neuron.isOutput){\n                outputTracker.push(neuron.id);\n                if (!(k in spikeAdds)) {\n                    spikeAdds[k] = 0\n                  }\n            }else if(neuron.delay==-1){\n                draft[neuron.id].delay=0;\n            }\n        }\n        for (const k in spikeAdds) {\n            //states[k].spikes -= spikeAdds[k]\n            let newSpikes = draft[k].spikes.valueOf();\n            newSpikes+=spikeAdds[k];\n            draft[k].spikes = newSpikes;\n            if(draft[k].isOutput){\n                var newString = `${draft[k].bitstring}${(spikeAdds[k] || '0')}`\n                draft[k].bitstring=newString;\n            }\n        }\n        //console.log(\"should end\", shouldEnd);\n        if(shouldEnd){\n            handleSimulationEnd();\n        }\n\n    })\n    localStorage.setItem(time+'sec',JSON.stringify(newStates));\n    return newStates;\n    \n}\n\nexport function backStep(time){\n    console.log(\"back step automata\");\n    var oldState = JSON.parse(localStorage.getItem(time+'sec'));\n    return oldState;\n    \n}\nexport function initialize(neurons) {\n    const states = {}\n    for (const k in neurons) {\n      const neuron = neurons[k]\n      states[k] = initializeState(neuron)\n    }\n    return states\n}\nexport function initializeState(neuron) {\n    return {\n      spikes: neuron.spikes,\n      delay: 0\n    }\n  }","import { useEffect, useState } from 'react';\nimport { Button, Form, Modal } from 'react-bootstrap';\nimport { useImmer } from 'use-immer';\n\nconst ChooseRuleForm = ({showChooseRuleModal, handleCloseChooseRuleModal,rules, handleChosenRules}) => {\n    const [values, setValues] = useImmer({});\n    useEffect(()=>{\n        setValues(currentValues =>{\n            for (var k in rules){\n                currentValues[k] = rules[k][0];\n            }\n        })\n    },[rules])\n    function onSubmit(e){\n        e.preventDefault();\n        handleChosenRules(values);\n    }\n    function handleSelectChange(event,neuronId){\n        setValues(currentValues =>{\n            for (var k in currentValues){\n                if(k == neuronId){\n                    currentValues[k] = event.target.value;\n                }\n              \n            }\n        })\n    }\n    const GroupRules = (label,options) =>{\n        let neuronOptions = options.map((neuron)=>(\n            <option value={neuron} key={neuron}>{neuron}</option>)\n        )   \n        return(\n            <Form.Group>\n                <Form.Label>{label}</Form.Label>\n                <Form.Control as=\"select\" value={values[label]} onChange={(event)=>handleSelectChange(event, label)}>\n                    {neuronOptions}\n                </Form.Control>\n            </Form.Group>\n            \n        )\n    }\n    var ruleList = Object.keys(rules);\n    var form = [];\n    for (var i=0; i<ruleList.length; i++){\n        console.log(i);\n        form.push(GroupRules(ruleList[i], rules[ruleList[i]], handleSelectChange));\n    }\n    return (\n        <Modal show={showChooseRuleModal} onHide={handleCloseChooseRuleModal} backdrop=\"static\" keyboard={false}>\n            <Modal.Header>\n                <Modal.Title>Choose Rule Form</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n            <Form onSubmit={onSubmit}>\n                    {form}\n                <Button type=\"submit\">Submit</Button>\n            </Form>\n\n        </Modal.Body>\n        </Modal>\n    )\n}\n\nexport default ChooseRuleForm;","import { Button, Form, Modal } from 'react-bootstrap';\nimport { useReducer, useState } from 'react';\nimport { allRulesValid } from \"../../utils/helpers\";\nimport shortid from \"shortid\";\n\nconst formReducer = (state, event) => {\n  if (event.reset) {\n    return {\n      id:'',\n      startingSpikes: 0,\n      rules: '',\n    }\n  }\n  return {\n    ...state,\n    [event.name]: event.value\n  }\n}\n\nconst initialFormState = {id:\"\", rules:\"\", startingSpikes:0}; \n\nconst NewNodeForm = ({ showNewNodeModal, handleCloseModal, handleNewNode, handleError }) => {\n  const handleClose = () => {\n    handleCloseModal();\n  };\n  const [formData, setFormData] = useReducer(formReducer, initialFormState);\n  const [submitting, setSubmitting] = useState(false);\n  const handleChange = event => {\n    console.log(event.target.value);\n    console.log(event.target.name);\n    setFormData({\n      name: event.target.name,\n      value: event.target.value,\n    });\n  };\n  function handleSubmit(event) {\n    event.preventDefault();\n    let newId = `${formData.id}-${shortid.generate()}`;\n\n    if (allRulesValid(formData.rules)) {\n      console.log(\"All rules valid\");\n      handleClose();\n      setSubmitting(true);\n\n      setTimeout(() => {\n        setSubmitting(false);\n        setFormData({\n          reset: true\n        })\n      }, 3000);\n      const newNeuron = {\n        id: newId,\n        position: { x: 100, y: 100 },\n        rules: formData.rules,\n        startingSpikes: parseInt(formData.startingSpikes),\n        delay: 0,\n        spikes: parseInt(formData.startingSpikes),\n        isOutput: false,\n        out: []\n      }\n      handleNewNode(newNeuron);\n    } else {\n      console.log(\"One or more of the rules is invalid\");\n      handleError(\"One or more of the rules is invalid\");\n      handleClose();\n    };\n  }\n\n  return (\n    <Modal show={showNewNodeModal} onHide={handleClose}>\n      <Modal.Header closeButton>\n        <Modal.Title>Create New Node</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        <Form onSubmit={handleSubmit}>\n        <Form.Group>\n            <Form.Label>Node Name</Form.Label>\n            <Form.Control  required name=\"id\" type=\"text\" placeholder=\"n0\" value={formData.id} onChange={handleChange} />\n          </Form.Group>\n          <Form.Group>\n            <Form.Label>Node Rules</Form.Label>\n            <Form.Control required name=\"rules\" type=\"text\" placeholder=\"a/a->a;0 aa/a->a;1\" value={formData.rules} onChange={handleChange} />\n            <Form.Text className=\"text-muted\">\n              Enter valid rules only. Separate each rule with a space.\n              </Form.Text>\n          </Form.Group>\n          <Form.Group>\n            <Form.Label>Starting Spike Number</Form.Label>\n            <Form.Control required name=\"startingSpikes\" type=\"number\" value={formData.startingSpikes} onChange={handleChange} />\n          </Form.Group>\n          <Button variant=\"secondary\" onClick={handleClose}>\n            Close\n            </Button> {' '}\n          <Button type=\"submit\" variant=\"primary\">\n            Save Changes\n            </Button>\n        </Form>\n      </Modal.Body>\n    </Modal>\n  )\n}\nexport default NewNodeForm;","import { Button, Form, Modal } from 'react-bootstrap';\nimport { useReducer, useState } from 'react';\nimport { allRulesValid } from \"../../utils/helpers\";\nimport shortid from \"shortid\";\n\nconst formReducer = (state, event) => {\n  if (event.reset) {\n    return {\n      id:'',\n    }\n  }\n  return {\n    ...state,\n    [event.name]: event.value\n  }\n}\n\nconst initialFormState = {id:\"\"}; \n\nconst NewOutputNodeForm = ({ showNewOutputModal, handleCloseNewOutputModal, handleNewOutput, handleError }) => {\n  const handleClose = () => {\n    handleCloseNewOutputModal();\n  };\n  const [formData, setFormData] = useReducer(formReducer, initialFormState);\n  const [submitting, setSubmitting] = useState(false);\n  const handleChange = event => {\n    console.log(event.target.value);\n    console.log(event.target.name);\n    setFormData({\n      name: event.target.name,\n      value: event.target.value,\n    });\n  };\n  function handleSubmit(event) {\n    event.preventDefault();\n    let newId = `${formData.id}-${shortid.generate()}`;\n      handleClose();\n      setSubmitting(true);\n\n      setTimeout(() => {\n        setSubmitting(false);\n        setFormData({\n          reset: true\n        })\n      }, 3000);\n      const newOutput = {\n        id: newId,\n        position: { x: 300, y: 300 },\n        isOutput: true,\n        spikes: 0,\n        bitstring: ' '\n      }\n      handleNewOutput(newOutput);\n  }\n\n  return (\n    <Modal show={showNewOutputModal} onHide={handleClose}>\n      <Modal.Header closeButton>\n        <Modal.Title>Create New Node</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        <Form onSubmit={handleSubmit}>\n        <Form.Group>\n            <Form.Label>Output Node Name</Form.Label>\n            <Form.Control  required name=\"id\" type=\"text\" placeholder=\"n0\" value={formData.id} onChange={handleChange} />\n          </Form.Group>\n          <Button variant=\"secondary\" onClick={handleClose}>\n            Close\n            </Button> {' '}\n          <Button type=\"submit\" variant=\"primary\">\n            Save Changes\n            </Button>\n        </Form>\n      </Modal.Body>\n    </Modal>\n  )\n}\nexport default NewOutputNodeForm;","import { Button, Form, Modal } from 'react-bootstrap';\nimport { useEffect, useReducer, useState } from 'react';\nimport { allRulesValid } from \"../../utils/helpers\";\n\nconst EditNodeForm = ({ showEditModal, handleCloseEditModal, handleEditNode, handleError, neurons }) => {\n    const [neuronId, setNeuronId] = useState('');\n    const [rules, setRules] = useState('');\n    const [startingSpikes, setStartingSpikes] = useState(0);\n    const handleClose = () => {\n        handleCloseEditModal();\n    };\n    useEffect(()=>{\n        firstUpdate();\n    },[]);\n    function firstUpdate(){\n        var filteredObject = Object.keys(neurons).reduce(function(r, e) {\n            if (!neurons[e].isOutput) r[e] = neurons[e];\n            return r;\n        }, {});\n        var keys = Object.keys(filteredObject);\n        setNeuronId(keys[0]);\n        setRules(filteredObject[keys[0]].rules);\n        setStartingSpikes(filteredObject[keys[0]].startingSpikes);\n    }\n    var filteredObject = Object.keys(neurons).reduce(function(r, e) {\n        if (!neurons[e].isOutput) r[e] = neurons[e];\n        return r;\n    }, {});\n    let neuronOptions = Object.keys(filteredObject).map((neuron)=>(\n        <option value={neuron} key={neuron}>{neuron}</option>)\n    )   \n    function handleSelectChange(event){\n        //console.log(event.target.value);\n        let id = event.target.value;\n        setNeuronId(event.target.value);\n        setRules(neurons[id].rules);\n        setStartingSpikes(neurons[id].startingSpikes);\n    }\n    function handleSubmit(event) {\n        event.preventDefault();\n        if (allRulesValid(rules)) {\n            console.log(\"All rules valid\");\n            handleClose();\n            setTimeout(() => {\n                setNeuronId('');\n                setRules('');\n                setStartingSpikes(0);\n            }, 3000);\n            handleEditNode(neuronId, rules, startingSpikes);\n        } else {\n            console.log(\"One or more of the rules is invalid\");\n            handleError(\"One or more of the rules is invalid\");\n        };\n    }\n\n    return (\n        <Modal show={showEditModal} onHide={handleClose}>\n            <Modal.Header closeButton>\n                <Modal.Title>Edit Node</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <Form onSubmit={handleSubmit}>\n                    <Form.Group>\n                        <Form.Label>Select node to edit</Form.Label>\n                        <Form.Control as=\"select\" value={neuronId} onChange={handleSelectChange}>\n                            {neuronOptions}\n                        </Form.Control>\n                    </Form.Group>\n                    <Form.Group>\n                        <Form.Label>Node Rules</Form.Label>\n                        <Form.Control required name=\"rules\" type=\"text\" placeholder=\"a/a->a;0 aa/a->a;1\" value={rules} onChange={(event)=>{setRules(event.target.value)}} />\n                        <Form.Text className=\"text-muted\">\n                            Enter valid rules only. Separate each rule with a space.\n                        </Form.Text>\n                    </Form.Group>\n                    <Form.Group>\n                        <Form.Label>Starting Spike Number</Form.Label>\n                        <Form.Control required name=\"startingSpikes\" type=\"number\" placeholder=\"0\" value={startingSpikes} onChange={(event)=>setStartingSpikes(event.target.value)} />\n                    </Form.Group>\n                    <Button variant=\"secondary\" onClick={handleClose}>\n                        Close\n            </Button> {' '}\n                    <Button type=\"submit\" variant=\"primary\">\n                        Save Changes\n            </Button>\n                </Form>\n            </Modal.Body>\n        </Modal>\n    )\n}\nexport default EditNodeForm;","import { Button, Form, Modal } from 'react-bootstrap';\nimport { useReducer, useState } from 'react';\nimport { allRulesValid } from \"../../utils/helpers\";\n\nconst DeleteNodeForm = ({ showDeleteModal, handleCloseDeleteModal, handleDeleteNode, handleError, neurons }) => {\n    const [neuronId, setNeuronId] = useState('');\n    const handleClose = () => {\n        handleCloseDeleteModal();\n    };\n\n    //console.log(\"it's here\", neurons);\n    //console.log(\"neuron[0]\",Object.keys(neurons));\n    \n    let neuronOptions = Object.keys(neurons).map((neuron)=>(\n        <option value={neuron} key={neuron}>{neuron}</option>)\n    )\n\n    let defaultNeuron = Object.keys(neurons)[0];\n    //console.log(\"defaultNeuron\", defaultNeuron);\n\n    function handleSelectChange(event){\n        //console.log(\"Event.target.value\", event.target.value)\n        setNeuronId(event.target.value);\n    }\n    function handleSubmit(event) {\n        console.log(\"NeuronId\", neuronId);\n        event.preventDefault();\n        //console.log(neurons);\n        if(neuronId!==''){\n            \n            handleClose();\n                setTimeout(() => {\n                    setNeuronId('');\n                }, 3000);\n                handleDeleteNode(neuronId);\n        }else{\n            handleClose();\n                setTimeout(() => {\n                    setNeuronId('');\n                }, 3000);\n                handleDeleteNode(defaultNeuron);\n            //handleError(`Please input a neuron id ${neuronId} none`);\n            //handleClose();\n        }\n    }\n\n    return (\n        <Modal show={showDeleteModal} onHide={handleClose}>\n            <Modal.Header closeButton>\n                <Modal.Title>Delete Node</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <Form onSubmit={handleSubmit}>\n                    <Form.Group>\n                        <Form.Label>Select node to delete</Form.Label>\n                        <Form.Control as=\"select\" value={neuronId} onChange={handleSelectChange}>\n                            {neuronOptions}\n                        </Form.Control>\n                    </Form.Group>\n                    <Button variant=\"secondary\" onClick={handleClose}>\n                        Close\n            </Button> {' '}\n                    <Button type=\"submit\" variant=\"danger\">\n                        Delete neuron\n            </Button>\n                </Form>\n            </Modal.Body>\n        </Modal>\n    )\n}\nexport default DeleteNodeForm;","import { Table, Modal } from \"react-bootstrap\"\nimport './ChoiceHistory.css';\nconst ChoiceHistory = ({time,showChoiceHistoryModal,handleCloseHoiceHistoryModal}) =>{\n    var getLatestState = JSON.parse(localStorage.getItem(time-1+\"sec\"));\n    var neuronIds = \"There are no neurons\";\n    if(getLatestState){\n        neuronIds = Object.keys(getLatestState).map((neuron)=>(\n            <th key={neuron}>{neuron}</th>)\n        )\n    }\n    var neuronRows = [];\n    \n    for(var i = 0; i<time; i++){\n        var neuronCells=[];\n        neuronCells.push(TableCell(i));\n        var state = JSON.parse(localStorage.getItem(i+\"sec\"));\n        for(var k in state){\n            if(state[k].chosenRule){\n                neuronCells.push(TableCell(state[k].chosenRule));\n            }else{\n                neuronCells.push(TableCell(\"No chosen rule\"));\n            }\n        }\n        neuronRows.push(TableRow(neuronCells));\n        neuronCells = []\n    }\n    return(\n        <Modal show={showChoiceHistoryModal} onHide={handleCloseHoiceHistoryModal} className=\"custom-choice-history-modal\">\n                <Table striped bordered hover>\n                    <thead>\n                        <tr>\n                            <th>Time</th>\n                            {neuronIds}\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {neuronRows}\n                    </tbody>\n                </Table>\n        </Modal>\n    )\n};\n\nconst TableCell = (content) =>{\n    return(\n        <td>\n            {content}\n        </td>\n    )\n};\n\nconst TableRow = (content)=>{\n    return (\n        <tr>\n            {content}\n        </tr>\n    )\n}\n\nexport default ChoiceHistory;","import { useEffect, useState } from \"react\"\nimport { Prompt } from \"react-router-dom\";\n\nconst useUnsavedChanges = () =>{\n    const [isDirty, setDirty] = useState(false);\n    const message = \"Are you sure you want to exit without saving your system?\"\n    useEffect(()=>{\n        // function handleUnsavedChanges (){\n        //     console.log(\"isDirty:\" + isDirty);\n        // }\n        window.onbeforeunload = isDirty && (() => message);\n\n        //window.addEventListener(\"beforeunload\", handleUnsavedChanges);\n        return () => {\n            //window.removeEventListener(\"beforeunload\", handleUnsavedChanges);\n            window.onbeforeunload = null;\n        }\n    },[isDirty]);\n    const routerPrompt = <Prompt when={isDirty} message={message} />\n    return [routerPrompt, ()=>setDirty(true), ()=>setDirty(false)];\n}\nexport default useUnsavedChanges;","import './scss/custom.scss';\nimport './App.css';\nimport { slide as Menu } from 'react-burger-menu'\nimport { useState, useEffect, useRef } from \"react\";\nimport { useImmer } from \"use-immer\";\nimport { Button, Container, Alert, Row, Col, Form, OverlayTrigger, Tooltip, Dropdown } from 'react-bootstrap';\nimport { PlayFill, PauseFill, SkipForwardFill, SkipBackwardFill, QuestionCircle, ClockFill, ClockHistory, PlusSquare, Save2 } from 'react-bootstrap-icons';\nimport styled, { css, keyframes } from 'styled-components'\nimport Snapse from \"./components/Snapse/Snapse\";\nimport shortid from 'shortid';\nimport { step, backStep, parseRule } from \"./utils/automata\";\nimport ChooseRuleForm from './components/forms/ChooseRuleForm';\nimport NewNodeForm from './components/forms/NewNodeForm';\nimport NewOutputNodeForm from './components/forms/NewOutputNodeForm';\nimport EditNodeForm from './components/forms/EditNodeForm';\nimport DeleteNodeForm from './components/forms/DeleteNodeForm';\nimport ChoiceHistory from './components/ChoiceHistory/ChoiceHistory';\nimport convert from 'xml-js';\nimport { HashRouter as Router, Switch, Route } from \"react-router-dom\";\nimport { saveAs } from 'file-saver';\nimport useUnsavedChanges from './components/useUnsavedChanges/useUnsavedChanges';\nimport { original } from 'immer';\nvar options = { compact: true, ignoreComment: true, spaces: 4, sanitize: false };\n\nfunction useKey(key, cb){\n  const isFocus = useRef(false);\n  const callbackRef = useRef(cb);\n\n  const inputs = document.getElementsByTagName('input');\n\n  // if user is typing in input elements, isFocus = true, and keybinds should not work\n  useEffect( () => {for (let input of inputs) {\n    input.addEventListener('focusin', () => {isFocus.current = true; console.log(\"fOCUS ON ME\");});\n    input.addEventListener('input', () => {isFocus.current = true; console.log(\"fOCUS ON ME 2\");});\n    input.addEventListener('focus', () => {isFocus.current = true; console.log(\"fOCUS ON ME 3\");}, true);\n    input.addEventListener('focusout', () => {isFocus.current = false});\n    }\n  })\n\n  useEffect(() => {\n    callbackRef.current = cb;\n  });\n  useEffect(()=> {\n    function debounced(delay, fn) {\n      let timerId;\n      return function (...args) {\n        if (timerId) {\n          clearTimeout(timerId);\n        }\n        timerId = setTimeout(() => {\n          fn(...args);\n          timerId = null;\n        }, delay);\n      }\n    }\n\n  function handleKeyDown(event){\n    console.log(`isFocus ${isFocus.current}`);\n    if(event.code === key && isFocus.current == false ){\n      console.log(`handleKeyDown isFocus: ${isFocus.current}`)\n      //event.preventDefault();\n      console.log(\"Key pressed: \" + event.code);\n      callbackRef.current(event);\n      }\n    }\n\n  document.addEventListener(\"keydown\", (event) => {if(event.code === \"Space\"&& isFocus == false){event.preventDefault();}});\n  document.addEventListener(\"keydown\", (debounced(300, handleKeyDown)));\n  return () => document.removeEventListener(\"keydown\", handleKeyDown);\n    }, [key]);\n}\n\nfunction App() {\n  const [neurons, setNeurons] = useImmer((window.localStorage.getItem('originalNeurons')!= null) ? JSON.parse(window.localStorage.getItem('originalNeurons')) : {\n    n1: {\n      id: \"n1\",\n      position: { x: 50, y: 50 },\n      rules: 'a+/a->a;2',\n      startingSpikes: 1,\n      delay: 0,\n      spikes: 1,\n      isOutput: false,\n      out: ['n2']\n    },\n    n2: {\n      id: \"n2\",\n      position: { x: 200, y: 50 },\n      rules: 'a/a->a;1',\n      startingSpikes: 0,\n      delay: 0,\n      spikes: 0,\n      isOutput: false,\n      out: ['n3']\n    },\n    n3: {\n      id: \"n3\",\n      position: { x: 400, y: 50 },\n      rules: 'a/a->a;0',\n      startingSpikes: 1,\n      delay: 0,\n      spikes: 1,\n      isOutput: false,\n      out: [\"n4\"]\n    },\n    n4: {\n      id: \"n4\",\n      position: { x: 400, y: 200 },\n      isOutput: true,\n      spikes: 0,\n      bitstring: ' '\n    }\n  });\n  const [time, setTime] = useState(0);\n  const [isRandom, setIsRandom] = useState(true);\n  const [fileName, setFileName] = useState('');\n  const [Prompt, setDirty, setPristine] = useUnsavedChanges();\n  const [showNewNodeModal, setShowNewNodeModal] = useState(false);\n  const [showNewOutputModal, setShowNewOutputModal] = useState(false);\n  const [showChooseRuleModal, setShowChooseRuleModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [showChoiceHistoryModal, setShowChoiceHistoryModal] = useState(false);\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [hasEnded, setHasEnded] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [pBar, setPBar] = useState(0);\n  const handleClose = () => setShowNewNodeModal(false)\n  const handleShow = () => setShowNewNodeModal(true)\n  const handleCloseNewOutputModal = () => setShowNewOutputModal(false);\n  const handleShowNewOutputModal = () => setShowNewOutputModal(true);\n  const handleCloseEditModal = () => setShowEditModal(false);\n  const handleShowEditModal = () => setShowEditModal(true);\n  const handleCloseDeleteModal = () => setShowDeleteModal(false);\n  const handleShowDeleteModal = () => setShowDeleteModal(true);\n  const handleCloseChooseRuleModal = () => setShowChooseRuleModal(false);\n  const handleShowChoiceHistoryModal = () => setShowChoiceHistoryModal(true);\n  const handleCloseHoiceHistoryModal = () => setShowChoiceHistoryModal(false);\n  const handleSimulationEnd = () => {\n    setHasEnded(true);\n    setIsPlaying(false);\n    console.log(\"alert from simulationEnd\");\n    alert(\"Simulation has ended.\");\n  }\n\n  const showError = (text) => {\n    setError(text);\n    setTimeout(() => {\n      setError(\"\");\n    }, 3000);\n  }\n  const handleSave = () => {\n    //Convert JSON Array to string.\n    var wrapper = { content: neurons };\n    //console.log(neurons);\n    var result = convert.json2xml(wrapper, options);\n    //console.log(wrapper);\n    var blob = new Blob([result], { type: \"text/xml;charset=utf-8\", });\n    saveAs(blob, Date().toString() + \"-Neurons.xmp\");\n    setPristine();\n  }\n  const handleLoad = (input) => {\n    let file = input.files[0];\n    setHasEnded(false);\n\n    if (file.type && file.type.indexOf('text/xml') === -1) {\n\n      showError(\"File is not a xml file\");\n      return;\n    }\n    const reader = new FileReader();\n    function nativeType(value) {\n      var nValue = Number(value);\n      if (!isNaN(nValue)) {\n        return nValue;\n      }\n      var bValue = value.toLowerCase();\n      if (bValue === 'true') {\n        return true;\n      } else if (bValue === 'false') {\n        return false;\n      }\n      return value;\n    }\n    var removeJsonTextAttribute = async function (value, parentElement) {\n      try {\n        const parentOfParent = parentElement._parent;\n        const pOpKeys = Object.keys(parentElement._parent);\n        const keyNo = pOpKeys.length;\n        const keyName = pOpKeys[keyNo - 1];\n        const arrOfKey = parentElement._parent[keyName];\n        const arrOfKeyLen = arrOfKey.length;\n        if (arrOfKeyLen > 0) {\n          const arr = arrOfKey;\n          const arrIndex = arrOfKey.length - 1;\n          arr[arrIndex] = value;\n        } else if (keyName == \"out\") {\n          parentElement._parent[keyName] = [value];\n        } else if (keyName == \"bitstring\") {\n          console.log(\"bitstring\");\n          parentElement._parent[keyName] = \"\";\n        }\n        else {\n          parentElement._parent[keyName] = nativeType(value);\n        }\n\n      } catch (e) { }\n    }\n    reader.addEventListener('load', async (event) => {\n      var options = {\n        compact: true,\n        trim: true,\n        ignoreDeclaration: true,\n        ignoreInstruction: true,\n        ignoreAttributes: true,\n        ignoreComment: true,\n        ignoreCdata: true,\n        ignoreDoctype: true,\n        textFn: removeJsonTextAttribute\n      };\n      var result = await convert.xml2js(event.target.result, options);\n      console.log(\"Result.content\"); \n      await setNeurons(draft => draft = result.content);\n      await setNeurons(draft => {\n        for (var k in draft) {\n          if (draft[k].bitstring) {\n            console.log(draft[k].bitstring);\n            draft[k].bitstring = \" \";\n          }\n        }\n      })\n      window.localStorage.setItem('originalNeurons', JSON.stringify(result.content));\n      setFileName(file.name);\n    });\n    reader.readAsText(file);\n    setTime(0);\n  }\n\n  const onEdgeCreate = async (src, dst) => {\n    console.log(\"newEdge\", src, dst);\n    await setNeurons(draft => {\n      var outCopy = [...draft[src].out];\n      outCopy.push(dst)\n      draft[src].out = outCopy;\n    })\n\n\n  }\n  const handleNewPosition = async (position, id) => {\n    setNeurons(draft => {\n      draft[id].position = position;\n    });\n    setDirty(true);\n\n  }\n  async function handleNewNode(newNeuron) {\n    await setNeurons(draft => {\n      draft[newNeuron.id] = newNeuron;\n    })\n    setDirty(true);\n    window.localStorage.setItem('originalNeurons', JSON.stringify(JSON.parse(JSON.stringify(neurons))));\n\n  }\n  async function handleNewOutput(newOutput) {\n    await setNeurons(draft => {\n      draft[newOutput.id] = newOutput;\n    });\n    setDirty(true);\n    window.localStorage.setItem('originalNeurons', JSON.stringify(JSON.parse(JSON.stringify(neurons))));\n  }\n  async function handleEditNode(id, rules, spikes) {\n    //console.log(\"handleEditNode\")\n    await setNeurons(draft => {\n      draft[id].startingSpikes = spikes;\n      draft[id].spikes = spikes;\n      draft[id].rules = rules;\n    });\n    setDirty(true);\n    window.localStorage.setItem('originalNeurons', JSON.stringify(JSON.parse(JSON.stringify(neurons))));\n  }\n  async function handleDeleteNode(neuronId) {\n    console.log(\"handleDeleteNode\", neuronId);\n    await setNeurons(draft => {\n      //first delete edges connected to neuron\n      for (var k in draft) {\n        var neuron = draft[k];\n\n        if (!neuron.isOutput) {\n          const neuronOutKeys = neuron.out;\n          let arr = neuron.out.filter(function (item) {\n            return item !== neuronId\n          });\n          draft[k].out = arr;\n        }\n      }\n      //delete neuron\n      delete draft[neuronId];\n    })\n    setDirty(true);\n    window.localStorage.setItem('originalNeurons', JSON.stringify(JSON.parse(JSON.stringify(neurons))));\n  }\n  function handlePlay() {\n    if (!hasEnded){\n      console.log(`isPlaying before ${isPlaying}`);\n      setIsPlaying(p => !p);\n      console.log(`isPlaying after ${isPlaying}`);\n    }else{\n      alert(\"Simulation has ended.\");\n    }\n  }\n  const renderTooltip = (props) => (\n    <Tooltip id=\"button-tooltip\" {...props}>\n      Pseudorandom will allow the system to decide which rule will be executed. Unchecking it will let you decide.\n    </Tooltip>\n  );\n  const handleReset = () => {\n    setNeurons(draft => draft = JSON.parse(window.localStorage.getItem('originalNeurons')));\n    setTime(0);\n    setIsPlaying(false);\n    setHasEnded(false);\n    var tempNeurons = window.localStorage.getItem('originalNeurons');\n    window.localStorage.clear();\n    window.localStorage.setItem('originalNeurons', tempNeurons);\n  }\n\n  const [guidedRules, setGuidedRules] = useState({});\n  const handleStartGuidedMode = async (rules) => {\n    await setGuidedRules(rules);\n\n    console.log(rules);\n    setShowChooseRuleModal(true);\n    if (setShowChooseRuleModal) {\n      setIsPlaying(false); //pauses the graph playing while choosing rule\n    }\n  }\n  const handleChosenRules = (data) => {\n    handleCloseChooseRuleModal();\n    setNeurons((draft) => {\n      for (var j in draft) {\n        for (var k in data) {\n          if (j == k) {\n            var [requires, grouped, symbol, consumes, produces, delay] = parseRule(data[k]);\n            draft[j].delay = delay\n            //console.log(data[k]);\n            draft[j].currentRule = data[k];\n            draft[j].chosenRule = data[k];\n          }\n        }\n      }\n    });\n    setIsPlaying(true); // continue playing after choosing rule\n  }\n  const onForward = async () => {\n    if (time == 0) {\n      //copy\n      console.log(\"Time is: \" + time);\n      window.localStorage.setItem('originalNeurons', JSON.stringify(JSON.parse(JSON.stringify(neurons))));\n      console.log(\"Original neurons on time = 1 \", window.localStorage.getItem('originalNeurons'));\n    }\n    if (!hasEnded) {\n      await setNeurons(neurons => step(neurons, time, isRandom, handleStartGuidedMode, handleSimulationEnd));\n      setTime(time => time + 1);\n    }else{\n      alert(\"Simulation has ended.\");\n    } \n  }\n  const onBackward = async () => {\n    if (time > 1) {\n      var tempTime = time.valueOf();\n      setHasEnded(false);\n      await setNeurons(neurons => backStep(tempTime - 2));\n      await setTime(time => time - 1);\n\n    }\n    else if (time == 1) {\n      handleReset();\n    }\n\n  }\n  const neuronsRef = useRef(neurons)\n  neuronsRef.current = neurons\n  const onIntervalStepRef = useRef(onForward)\n  onIntervalStepRef.current = () => {\n    onForward();\n    setPBar(p => p + 1);\n  }\n  useEffect(() => {\n    if (isPlaying) {\n      var interval = setInterval(() => {\n        onIntervalStepRef.current()\n      }, 3000)\n    }\n    return () => clearInterval(interval);\n  }, [isPlaying, onIntervalStepRef])\n\n  useEffect(() => {\n    if (showChooseRuleModal) {\n      console.log(\"showChooseRuleModal is true\");\n    }\n  }, [])\n\n    // Key Bindings \n    function handleSpace(){\n      console.log(\"Space Pressed\");\n      setIsPlaying(p => !p);\n    }\n  \n    function handleRightKey(){\n      console.log(\"Right Key Pressed\");\n      if(!hasEnded){\n        onIntervalStepRef.current();\n      }\n    }\n  \n    function handleLeftKey(){\n      console.log(\"Left Key Pressed\");\n      onBackward();\n    }\n  \n    useKey(\"Space\", handleSpace);\n    useKey(\"ArrowLeft\", handleLeftKey);\n    useKey(\"ArrowRight\", handleRightKey);\n  \n\n  return (\n    <Router>\n      <Switch>\n        <Route path=\"/\">\n          <Container>\n            {error && <Alert variant=\"danger\">\n              {error}\n            </Alert>}\n            <Menu>\n              \n              <Form>\n                <Form.File\n                  id=\"custom-file\"\n                  label={fileName ? fileName : \"Load file...\"}\n                  custom\n                  onChange={(e) => { handleLoad(e.target) }}\n                />\n              </Form>\n              <div>\n                <Button variant=\"primary\" disabled={time > 0 ? true : false} onClick={handleSave}><Save2/>{' '}Save</Button>\n              </div>\n              <div>\n                <Button variant=\"primary\" onClick={handleShowChoiceHistoryModal}><ClockHistory/>{' '}Choice History</Button>\n              </div>\n            </Menu>\n            <div>\n            <div style={{ textAlign: \"center\" }}>\n              <h1 style={{ fontWeight: \"700\"}} className=\"text-primary\">WebSnapse</h1>\n            </div>\n            <Row>\n              <Col>\n                <div>\n                  \n                  <Form>\n                    <Form.Group id=\"formGridCheckbox\">\n                      <Row>\n                        <Col sm={6}>\n                          <Form.Check type=\"checkbox\"\n                            label=\"Pseudorandom\"\n                            defaultChecked={isRandom}\n                            onChange={() => {\n                              setIsRandom(!isRandom)\n                            }} />\n                        </Col>\n\n                        <Col sm={1} style={{ textAlign: \"left\" }}>\n                          <OverlayTrigger\n                            placement=\"right\"\n                            delay={{ show: 250, hide: 400 }}\n                            overlay={renderTooltip}\n                          >\n                            <QuestionCircle />\n                          </OverlayTrigger>\n                        </Col>\n                      </Row>\n                    </Form.Group>\n                  </Form>\n                  { time == 0 ? <div></div> : \n                    <div style={{backgroundColor:\"#778beb\", color:\"white\", borderRadius:\"10px\", padding:\"0.5em\"}}>\n                      <ClockFill color=\"white\" size={30}/> <strong>Time:</strong> {time == 0 ? \"Start playing!\" : time}\n                    </div>\n                  }\n                  \n                </div>\n              </Col>\n              <Col>\n              <div className=\"snapse-controls\" style={{ textAlign: \"center\", marginBottom:\"0.8em\" }}>\n                <Button variant=\"link\" onClick={onBackward}><SkipBackwardFill /></Button>{' '}\n                <div style={{ display: 'inline-block' }}>\n                  <ProgressBar key={pBar} isPlaying={isPlaying} />\n                  <Button size=\"lg\" className=\"snapse-controls-play\" onClick={handlePlay}>{isPlaying ? <PauseFill /> : <PlayFill />}</Button>\n                </div> {' '}\n                <Button variant=\"link\" onClick={() => onForward()}><SkipForwardFill /></Button>{' '}\n\n              </div>\n              <div style={{textAlign:\"center\"}}>\n              <Dropdown>\n              <Dropdown.Toggle id=\"dropdown-basic\">\n                <PlusSquare/>{' '}Node Actions\n              </Dropdown.Toggle>\n              <Dropdown.Menu>\n              <Dropdown.Item><Button variant=\"link\" size=\"sm\" className=\"node-actions text-primary\" onClick={handleShow} disabled={time > 0 ? true : false}>New Node</Button></Dropdown.Item>\n                <Dropdown.Item><Button variant=\"link\" size=\"sm\" className=\"node-actions text-primary\" onClick={handleShowNewOutputModal} disabled={time > 0 ? true : false}>New Output Node</Button></Dropdown.Item>\n                <Dropdown.Item><Button variant=\"link\" size=\"sm\" className=\"node-actions text-info\" onClick={handleShowEditModal} disabled={time > 0 ? true : false}>Edit</Button></Dropdown.Item>\n                <Dropdown.Item><Button variant=\"link\" size=\"sm\" className=\"node-actions text-danger\" onClick={handleShowDeleteModal} disabled={time > 0 ? true : false}>Delete</Button></Dropdown.Item>\n              </Dropdown.Menu>\n              </Dropdown>\n              </div>\n              </Col>\n              <Col style={{textAlign:\"right\"}}><Button variant=\"danger\" onClick={handleReset}>Restart</Button>{' '}</Col>\n            </Row>\n            </div>\n            <hr />\n            <Snapse\n              neurons={neurons}\n              onEdgeCreate={(src, dst, addedEles) => {\n                onEdgeCreate(src.id(), dst.id())\n                addedEles.remove();\n              }}\n              handleChangePosition={handleNewPosition} />\n            <ChoiceHistory time={time}\n            showChoiceHistoryModal={showChoiceHistoryModal}\n            handleCloseHoiceHistoryModal={handleCloseHoiceHistoryModal} />\n            <NewNodeForm showNewNodeModal={showNewNodeModal}\n              handleCloseModal={handleClose}\n              handleNewNode={handleNewNode}\n              handleError={showError} />\n            <NewOutputNodeForm showNewOutputModal={showNewOutputModal}\n              handleCloseNewOutputModal={handleCloseNewOutputModal}\n              handleNewOutput={handleNewOutput}\n              handleError={showError} />\n            <EditNodeForm showEditModal={showEditModal}\n              handleCloseEditModal={handleCloseEditModal}\n              handleEditNode={handleEditNode}\n              handleError={showError}\n              neurons={neurons} />\n            <DeleteNodeForm showDeleteModal={showDeleteModal}\n              handleCloseDeleteModal={handleCloseDeleteModal}\n              handleDeleteNode={handleDeleteNode}\n              handleError={showError}\n              neurons={neurons}\n            />\n            <ChooseRuleForm showChooseRuleModal={showChooseRuleModal}\n              handleCloseChooseRuleModal={handleCloseChooseRuleModal}\n              rules={guidedRules}\n              handleChosenRules={handleChosenRules}\n            />\n            {Prompt}\n          </Container>\n        </Route>\n      </Switch>\n    </Router>\n  );\n}\n\nconst shortening = keyframes`\n  from {\n    transform: scaleX(100%);\n  }\n\n  to {\n    transform: scaleX(0%);\n  }\n`\nconst ProgressBar = styled.div`\n  ${props =>\n    props.isPlaying &&\n    css`\n      animation: ${shortening} 3s linear; \n    `}\n  background-color: #c44569;\n  height: 4px;\n  transform-origin: left center;\n  margin-bottom: 2px;\n`\n\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport cytoscape from 'cytoscape';\nimport edgehandles from 'cytoscape-edgehandles';\nimport gridGuide from 'cytoscape-grid-guide';\n\ncytoscape.use(edgehandles)\ncytoscape.use(gridGuide)\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}